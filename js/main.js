var BrowserWindow, MainMenu, MdsPresenDevWindow, MdsPresenWindow, MdsWindow, MickrWindow, Path, Tray, app, arg, break_arg, electron, exist, globalShortcut, ipc, j, len, mickrWin, opts, powerSaveBlocker, presenDevWin, presenWin, ref, ref1, resolved_file, slideInfo, tray, tray2, win;

global.marp || (global.marp = {
  config: require('./classes/mds_config'),
  development: false
});

ref = require('electron'), BrowserWindow = ref.BrowserWindow, app = ref.app;

Path = require('path');

MdsWindow = require('./classes/mds_window');

MdsPresenWindow = require('./classes/mds_presen_window');

MdsPresenDevWindow = require('./classes/mds_presen_dev_window');

MainMenu = require('./classes/mds_main_menu');

exist = require('./classes/mds_file').exist;

electron = require('electron');

ipc = electron.ipcMain;

MickrWindow = require('../MickrWindow.js');

Tray = electron.Tray;

globalShortcut = electron.globalShortcut;

powerSaveBlocker = electron.powerSaveBlocker;

slideInfo = "";

presenDevWin = null;

win = null;

mickrWin = null;

presenWin = null;

tray = null;

tray2 = null;

global.marp.config.initialize();

opts = {
  file: null
};

ref1 = process.argv.slice(1);
for (j = 0, len = ref1.length; j < len; j++) {
  arg = ref1[j];
  break_arg = false;
  switch (arg) {
    case '--development':
    case '--dev':
      global.marp.development = true;
      break;
    default:
      if (exist(resolved_file = Path.resolve(arg))) {
        opts.file = resolved_file;
        break_arg = true;
      }
  }
  if (break_arg) {
    break;
  }
}

app.on('window-all-closed', function() {
  if (process.platform !== 'darwin' || !!MdsWindow.appWillQuit) {
    return app.quit();
  }
});

app.on('before-quit', function() {
  return MdsWindow.appWillQuit = true;
});

app.on('activate', function(e, hasVisibleWindows) {
  if (app.isReady() && !hasVisibleWindows) {
    return new MdsWindow;
  }
});

app.on('open-file', function(e, path) {
  e.preventDefault();
  opts.fileOpened = true;
  return MdsWindow.loadFromFile(path, null);
});

app.on('ready', function() {
  mickrWin = new MickrWindow();
  mickrWin.activateMainWindows();
  tray = new Tray(Path.join(__dirname, '../', 'lib', 'img', 'cloud_on.png'));
  tray.on('click', (function(_this) {
    return function(e) {
      return mickrWin.switchShowMode(tray);
    };
  })(this));
  tray2 = new Tray(Path.join(__dirname, '../', 'lib', 'img', 'ic_pause_black_24dp_2x.png'));
  tray2.on('click', (function(_this) {
    return function(e) {
      return mickrWin.switchPause();
    };
  })(this));
  global.marp.mainMenu = new MainMenu({
    development: global.marp.development
  });
  if (!opts.fileOpened) {
    if (opts.file) {
      return MdsWindow.loadFromFile(opts.file, null);
    } else {
      return win = new MdsWindow;
    }
  }
});

ipc.on('textSend', (function(_this) {
  return function(e, text) {
    var data, dataString, displays, electronScreen, externalDisplay, i, idx, input, k, len1, nonHTML, py, spawn, value;
    console.log('receive textSend');
    _this.presenDevWin = new MdsPresenDevWindow({}, {}, text);
    electronScreen = electron.screen;
    displays = electronScreen.getAllDisplays();
    externalDisplay = null;
    for (k = 0, len1 = displays.length; k < len1; k++) {
      i = displays[k];
      if (i.bounds.x !== 0 || i.bounds.y !== 0) {
        externalDisplay = i;
        break;
      }
    }
    if (externalDisplay) {
      _this.presenWin = new MdsPresenWindow({
        x: externalDisplay.bounds.x + 50,
        y: externalDisplay.bounds.y + 50
      });
    } else {
      _this.presenWin = new MdsPresenWindow({
        width: 800,
        height: 600
      });
    }
    _this.slideInfo = text;
    nonHTML = [];
    for (idx in text) {
      value = text[idx];
      nonHTML[idx] = value.replace(/<(".*?"|'.*?'|[^'"])*?>/gi, " ");
      nonHTML[idx] = nonHTML[idx].replace(/\n/gi, "");
      nonHTML[idx] = nonHTML[idx].replace(/\s+/gi, "");
      nonHTML[idx] = nonHTML[idx].substr(0, nonHTML[idx].length - 1);
    }
    console.log(nonHTML);
    nonHTML = nonHTML.join("");
    console.log(nonHTML);
    input = [];
    input.push(nonHTML);
    spawn = require('child_process').spawn;
    py = spawn('python', [__dirname + "/../compute_input.py"]);
    data = input;
    dataString = '';
    py.stdout.on('data', function(data) {
      return dataString += data.toString();
    });
    py.stdout.on('end', function() {
      console.log(dataString);
      return mickrWin.getMainWindow().webContents.send('show', dataString);
    });
    py.stdin.write(JSON.stringify(data));
    return py.stdin.end();
  };
})(this));

ipc.on('goToPage', (function(_this) {
  return function(e, page) {
    console.log(page);
    return win.browserWindow.webContents.send('goToPage', page);
  };
})(this));

ipc.on('PdfExport', (function(_this) {
  return function() {
    console.log('PDF Export');
    return win.trigger('exportPdfDialog');
  };
})(this));

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsibWFpbi5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsSUFBQTs7QUFBQSxNQUFNLENBQUMsU0FBUCxNQUFNLENBQUMsT0FDTDtFQUFBLE1BQUEsRUFBUSxPQUFBLENBQVEsc0JBQVIsQ0FBUjtFQUNBLFdBQUEsRUFBYSxLQURiOzs7QUFHRixNQUEyQixPQUFBLENBQVEsVUFBUixDQUEzQixFQUFDLGlDQUFELEVBQWdCOztBQUNoQixJQUFBLEdBQVksT0FBQSxDQUFRLE1BQVI7O0FBQ1osU0FBQSxHQUFZLE9BQUEsQ0FBUSxzQkFBUjs7QUFDWixlQUFBLEdBQWtCLE9BQUEsQ0FBUSw2QkFBUjs7QUFDbEIsa0JBQUEsR0FBcUIsT0FBQSxDQUFRLGlDQUFSOztBQUNyQixRQUFBLEdBQVksT0FBQSxDQUFRLHlCQUFSOztBQUNYLFFBQVcsT0FBQSxDQUFRLG9CQUFSOztBQUNaLFFBQUEsR0FBWSxPQUFBLENBQVEsVUFBUjs7QUFDWixHQUFBLEdBQVksUUFBUSxDQUFDOztBQUNyQixXQUFBLEdBQWMsT0FBQSxDQUFRLG1CQUFSOztBQUNkLElBQUEsR0FBWSxRQUFRLENBQUM7O0FBQ3JCLGNBQUEsR0FBaUIsUUFBUSxDQUFDOztBQUMxQixnQkFBQSxHQUFtQixRQUFRLENBQUM7O0FBRzVCLFNBQUEsR0FBWTs7QUFDWixZQUFBLEdBQWU7O0FBQ2YsR0FBQSxHQUFNOztBQUNOLFFBQUEsR0FBVzs7QUFDWCxTQUFBLEdBQVk7O0FBRVosSUFBQSxHQUFPOztBQUNQLEtBQUEsR0FBUTs7QUFHUixNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFuQixDQUFBOztBQUdBLElBQUEsR0FDRTtFQUFBLElBQUEsRUFBTSxJQUFOOzs7QUFFRjtBQUFBLEtBQUEsc0NBQUE7O0VBQ0UsU0FBQSxHQUFZO0FBQ1osVUFBTyxHQUFQO0FBQUEsU0FDTyxlQURQO0FBQUEsU0FDd0IsT0FEeEI7TUFFSSxNQUFNLENBQUMsSUFBSSxD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Q0FBQSxTQUFBLEtBQUE7U0FBQSxTQUFBO0lBQ2xCLE9BQU8sQ0FBQyxHQUFSLENBQVksWUFBWjtXQUNBLEdBQUcsQ0FBQyxPQUFKLENBQVksaUJBQVo7RUFGa0I7QUFBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLENBQXBCIiwic291cmNlc0NvbnRlbnQiOlsiZ2xvYmFsLm1hcnAgb3I9XG4gIGNvbmZpZzogcmVxdWlyZSAnLi9jbGFzc2VzL21kc19jb25maWcnXG4gIGRldmVsb3BtZW50OiBmYWxzZVxuXG57QnJvd3NlcldpbmRvdywgYXBwfSAgICAgPSByZXF1aXJlICdlbGVjdHJvbidcblBhdGggICAgICA9IHJlcXVpcmUgJ3BhdGgnXG5NZHNXaW5kb3cgPSByZXF1aXJlICcuL2NsYXNzZXMvbWRzX3dpbmRvdydcbk1kc1ByZXNlbldpbmRvdyA9IHJlcXVpcmUgJy4vY2xhc3Nlcy9tZHNfcHJlc2VuX3dpbmRvdydcbk1kc1ByZXNlbkRldldpbmRvdyA9IHJlcXVpcmUgJy4vY2xhc3Nlcy9tZHNfcHJlc2VuX2Rldl93aW5kb3cnXG5NYWluTWVudSAgPSByZXF1aXJlICcuL2NsYXNzZXMvbWRzX21haW5fbWVudSdcbntleGlzdH0gICA9IHJlcXVpcmUgJy4vY2xhc3Nlcy9tZHNfZmlsZSdcbmVsZWN0cm9uICA9IHJlcXVpcmUgJ2VsZWN0cm9uJ1xuaXBjICAgICAgID0gZWxlY3Ryb24uaXBjTWFpblxuTWlja3JXaW5kb3cgPSByZXF1aXJlICcuLi9NaWNrcldpbmRvdy5qcydcblRyYXkgICAgICA9IGVsZWN0cm9uLlRyYXlcbmdsb2JhbFNob3J0Y3V0ID0gZWxlY3Ryb24uZ2xvYmFsU2hvcnRjdXRcbnBvd2VyU2F2ZUJsb2NrZXIgPSBlbGVjdHJvbi5wb3dlclNhdmVCbG9ja2VyXG4jIGFwcC5jb21tYW5kTGluZS5hcHBlbmRTd2l0Y2goXCItLWVuYWJsZS1leHBlcmltZW50YWwtd2ViLXBsYXRmb3JtLWZlYXR1cmVzXCIpO1xuIyBhYm91dCBwcmVzZW50YXRpb25cbnNsaWRlSW5mbyA9IFwiXCJcbnByZXNlbkRldldpbiA9IG51bGxcbndpbiA9IG51bGxcbm1pY2tyV2luID0gbnVsbFxucHJlc2VuV2luID0gbnVsbFxuXG50cmF5ID0gbnVsbDtcbnRyYXkyID0gbnVsbDtcblxuIyBJbml0aWFsaXplIGNvbmZpZ1xuZ2xvYmFsLm1hcnAuY29uZmlnLmluaXRpYWxpemUoKVxuXG4jIFBhcnNlIGFyZ3VtZW50c1xub3B0cyA9XG4gIGZpbGU6IG51bGxcblxuZm9yIGFyZyBpbiBwcm9jZXNzLmFyZ3Yuc2xpY2UoMSlcbiAgYnJlYWtfYXJnID0gZmFsc2VcbiAgc3dpdGNoIGFyZ1xuICAgIHdoZW4gJy0tZGV2ZWxvcG1lbnQnLCAnLS1kZXYnXG4gICAgICBnbG9iYWwubWFycC5kZXZlbG9wbWVudCA9IHRydWVcbiAgICBlbHNlXG4gICAgICBpZiBleGlzdChyZXNvbHZlZF9maWxlID0gUGF0aC5yZXNvbHZlKGFyZykpXG4gICAgICAgIG9wdHMuZmlsZSA9IHJlc29sdmVkX2ZpbGVcbiAgICAgICAgYnJlYWtfYXJnID0gdHJ1ZVxuXG4gIGJyZWFrIGlmIGJyZWFrX2FyZ1xuXG4jIEFwcGxpY2F0aW9uIGV2ZW50c1xuYXBwLm9uICd3aW5kb3ctYWxsLWNsb3NlZCcsIC0+XG4gIGlmIHByb2Nlc3MucGxhdGZvcm0gIT0gJ2Rhcndpbicgb3IgISFNZHNXaW5kb3cuYXBwV2lsbFF1aXRcbiAgICAjIGdsb2JhbC5tYXJwLmNvbmZpZy5zYXZlKClcbiAgICBhcHAucXVpdCgpXG5cbmFwcC5vbiAnYmVmb3JlLXF1aXQnLCAtPlxuICBNZHNXaW5kb3cuYXBwV2lsbFF1aXQgPSB0cnVlXG5cbmFwcC5vbiAnYWN0aXZhdGUnLCAoZSwgaGFzVmlzaWJsZVdpbmRvd3MpIC0+XG4gIG5ldyBNZHNXaW5kb3cgaWYgYXBwLmlzUmVhZHkoKSBhbmQgbm90IGhhc1Zpc2libGVXaW5kb3dzXG5cbmFwcC5vbiAnb3Blbi1maWxlJywgKGUsIHBhdGgpIC0+XG4gIGUucHJldmVudERlZmF1bHQoKVxuXG4gIG9wdHMuZmlsZU9wZW5lZCA9IHRydWVcbiAgTWRzV2luZG93LmxvYWRGcm9tRmlsZSBwYXRoLCBudWxsXG5cbmFwcC5vbiAncmVhZHknLCAtPlxuICAjIG1pY2tyIOOBruOCpuOCpOODs+ODieOCplxuXG4gIG1pY2tyV2luID0gbmV3IE1pY2tyV2luZG93KClcbiAgbWlja3JXaW4uYWN0aXZhdGVNYWluV2luZG93cygpXG4gICMvKiDjg6Hjg4vjg6Xjg7zjg5Djg7zkuIrjga7jgqLjgqTjgrPjg7PjgYzmirzjgZXjgozjgZ/loLTlkIjjga7lh6bnkIYgKi9cbiAgdHJheSA9IG5ldyBUcmF5KFBhdGguam9pbiBfX2Rpcm5hbWUsICcuLi8nLCdsaWInLCAnaW1nJywgJ2Nsb3VkX29uLnBuZycpXG4gIHRyYXkub24gJ2NsaWNrJywgKGUpID0+XG4gICAgbWlja3JXaW4uc3dpdGNoU2hvd01vZGUodHJheSlcblxuICB0cmF5MiA9IG5ldyBUcmF5KFBhdGguam9pbiBfX2Rpcm5hbWUsICcuLi8nLCdsaWInLCAnaW1nJywgJ2ljX3BhdXNlX2JsYWNrXzI0ZHBfMngucG5nJylcbiAgdHJheTIub24gJ2NsaWNrJywgKGUpID0+XG4gICAgbWlja3JXaW4uc3dpdGNoUGF1c2UoKVxuXG4gICMg44Ki44OX44Oq44Gu44Km44Kk44Oz44OJ44KmXG4gIGdsb2JhbC5tYXJwLm1haW5NZW51ID0gbmV3IE1haW5NZW51XG4gICAgZGV2ZWxvcG1lbnQ6IGdsb2JhbC5tYXJwLmRldmVsb3BtZW50XG5cbiAgdW5sZXNzIG9wdHMuZmlsZU9wZW5lZFxuICAgIGlmIG9wdHMuZmlsZVxuICAgICAgTWRzV2luZG93LmxvYWRGcm9tRmlsZSBvcHRzLmZpbGUsIG51bGxcbiAgICBlbHNlXG4gICAgICB3aW4gPSBuZXcgTWRzV2luZG93XG5cbiAjIHJlY2VpdmUgVGV4dFxuaXBjLm9uICd0ZXh0U2VuZCcsIChlLCB0ZXh0KSA9PlxuICBjb25zb2xlLmxvZyAncmVjZWl2ZSB0ZXh0U2VuZCdcbiAgI2NvbnNvbGUubG9nIHRleHRcblxuICBAcHJlc2VuRGV2V2luPSBuZXcgTWRzUHJlc2VuRGV2V2luZG93IHt9LCB7fSwgdGV4dFxuXG4gIGVsZWN0cm9uU2NyZWVuID0gZWxlY3Ryb24uc2NyZWVuXG4gIGRpc3BsYXlzID0gZWxlY3Ryb25TY3JlZW4uZ2V0QWxsRGlzcGxheXMoKVxuICBleHRlcm5hbERpc3BsYXkgPSBudWxsXG4gIGZvciBpIGluIGRpc3BsYXlzXG4gICAgaWYgKGkuYm91bmRzLnggIT0gMCB8fCBpLmJvdW5kcy55ICE9IDApXG4gICAgICBleHRlcm5hbERpc3BsYXkgPSBpXG4gICAgICBicmVha1xuICAj44CA5aSW6YOo44OH44Kj44K544OX44Os44Kk44GM5a2Y5Zyo44GZ44KL5aC05ZCIXG4gIGlmIChleHRlcm5hbERpc3BsYXkpXG4gICAgQHByZXNlbldpbiA9IG5ldyBNZHNQcmVzZW5XaW5kb3dcbiAgICAgIHg6IGV4dGVybmFsRGlzcGxheS5ib3VuZHMueCArIDUwLFxuICAgICAgeTogZXh0ZXJuYWxEaXNwbGF5LmJvdW5kcy55ICsgNTBcbiAgIyDlpJbpg6jjg4fjgqPjgrnjg5fjg6zjgqTjgYzlrZjlnKjjgZfjgarjgYTloLTlkIhcbiAgZWxzZVxuICAgIEBwcmVzZW5XaW4gPSBuZXcgTWRzUHJlc2VuV2luZG93XG4gICAgICB3aWR0aDo4MDBcbiAgICAgIGhlaWdodDogNjAwXG4gICMgdGV4dCDjgavjga/jgIFzbGlkZV93cmFwcGVy44GuSFRNTOimgee0oOOBjGlk6aCG44Gr5YWl44Gj44Gm44GE44KLXG4gIEBzbGlkZUluZm8gPSB0ZXh0XG4gIG5vbkhUTUwgPSBbXVxuXG4gICMgaHRtbOOCv+OCsOWJiumZpCAmIOaWh+Wtl+WIl+OBruW9ouOCkuaVtOOBiOOCi1xuICBmb3IgaWR4LCB2YWx1ZSBvZiB0ZXh0XG4gICAgbm9uSFRNTFtpZHhdID0gdmFsdWUucmVwbGFjZSgvPChcIi4qP1wifCcuKj8nfFteJ1wiXSkqPz4vZ2ksIFwiIFwiKSAgICAjIEhUTUzjgr/jgrDmtojljrtcbiAgICBub25IVE1MW2lkeF0gPSBub25IVE1MW2lkeF0ucmVwbGFjZSgvXFxuL2dpLCBcIlwiKSAgIyDmlLnooYzmloflrZfjga7liYrpmaRcbiAgICBub25IVE1MW2lkeF0gPSBub25IVE1MW2lkeF0ucmVwbGFjZSgvXFxzKy9naSwgXCJcIikgIyDnqbrnmb3jga7liYrpmaRcbiAgICBub25IVE1MW2lkeF0gPSBub25IVE1MW2lkeF0uc3Vic3RyKDAsIG5vbkhUTUxbaWR4XS5sZW5ndGgtMSkgICMg5pyr5bC+44Gr44Oa44O844K45pWw44GM5YWl44KL44Gu44Gn44CB5pyr5bC+44KS5YmK6ZmkXG5cbiAgIyBodG1s44K/44Kw44KS5ZCr44G+44Gq44GE5pys5paHXG4gIGNvbnNvbGUubG9nIG5vbkhUTUxcbiAgIyDjgZ3jgozjgZ7jgozjga7jgrnjg6njgqTjg4njga7jg4bjgq3jgrnjg4jjgpLntZDlkIjjgZfjgIHjg6rjgrnjg4jjgavkuIDjgaTjga7opoHntKDjgajjgZfjgablhaXjgozjgaZcbiAgIyDjgIHjgZ3jgozjgpJweXRob27jgavmuKHjgZlcbiAgbm9uSFRNTCA9IG5vbkhUTUwuam9pbihcIlwiKVxuICBjb25zb2xlLmxvZyBub25IVE1MXG4gIGlucHV0ID0gW11cbiAgaW5wdXQucHVzaChub25IVE1MKVxuXG5cbiAgIyBweXRob24g44OX44Ot44K744K555Sf5oiQ44CB44Gd44GX44Gm57WQ5p6c44KS5Y+X44GR5Y+W44KLXG4gIHNwYXduID0gcmVxdWlyZSgnY2hpbGRfcHJvY2VzcycpLnNwYXduXG4gIHB5ICAgID0gc3Bhd24oJ3B5dGhvbicsIFtcIiN7X19kaXJuYW1lfS8uLi9jb21wdXRlX2lucHV0LnB5XCJdKVxuICBkYXRhID0gaW5wdXRcbiAgZGF0YVN0cmluZyA9ICcnXG5cbiAgcHkuc3Rkb3V0Lm9uICdkYXRhJywgKGRhdGEpID0+XG4gICAgZGF0YVN0cmluZyArPSBkYXRhLnRvU3RyaW5nKClcblxuICBweS5zdGRvdXQub24gJ2VuZCcsICgpID0+XG4gICAgIGNvbnNvbGUubG9nIGRhdGFTdHJpbmdcbiAgICAgIyDliIbpoZ7ntZDmnpwg6Zuy44Gn6KGo56S6XG4gICAgIG1pY2tyV2luLmdldE1haW5XaW5kb3coKS53ZWJDb250ZW50cy5zZW5kICdzaG93JywgZGF0YVN0cmluZ1xuXG4gIHB5LnN0ZGluLndyaXRlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgcHkuc3RkaW4uZW5kKClcblxuIyBpcGMub24gJ3JlcXVlc3RTbGlkZUluZm8nLCAoKSA9PlxuIyAgIGNvbnNvbGUubG9nICdyZWNlaXZlIHJlcXVlc3RTbGlkZUluZm8nXG4jICAgQHByZXNlbkRldldpbi53ZWJDb250ZW50cy5zZW5kICdzZW5kU2xpZGVJbmZvJywgQHNsaWRlSW5mb1xuXG5pcGMub24gJ2dvVG9QYWdlJywgKGUsIHBhZ2UpID0+XG4gIGNvbnNvbGUubG9nIHBhZ2VcbiAgd2luLmJyb3dzZXJXaW5kb3cud2ViQ29udGVudHMuc2VuZCAnZ29Ub1BhZ2UnLCBwYWdlXG5cbmlwYy5vbiAnUGRmRXhwb3J0JywgKCkgPT5cbiAgY29uc29sZS5sb2cgJ1BERiBFeHBvcnQnXG4gIHdpbi50cmlnZ2VyICdleHBvcnRQZGZEaWFsb2cnXG4jIGlwYy5vbiAnUHJlc2VudGF0aW9uJywgKCkgPT5cbiMgICBwcmVzZW5EZXZXaW4gPSBuZXcgTWRzV2luZG93XG4jICAgcHJlc2VuRGV2V2luLndlYkNvbnRlbnRzLnNlbmQgJ2luaXRpYWxpemUnXG4jICAgcHJlc2VuRGV2V2luLm9wZW5EZXZUb29scygpXG5cbiJdfQ==
