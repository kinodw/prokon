var BrowserWindow, MainMenu, MdsPresenDevWindow, MdsPresenWindow, MdsWindow, MickrClient, MickrWindow, Path, Tray, app, arg, break_arg, client, dialog, electron, exist, fs, globalShortcut, ipc, j, len, mickrWin, opts, powerSaveBlocker, presenDevWin, presenWin, ref, ref1, resolved_file, setting, slideInfo, tray, tray2, win;

global.marp || (global.marp = {
  config: require('./classes/mds_config'),
  development: false
});

ref = require('electron'), BrowserWindow = ref.BrowserWindow, app = ref.app, dialog = ref.dialog;

Path = require('path');

MdsWindow = require('./classes/mds_window');

MdsPresenWindow = require('./classes/mds_presen_window');

MdsPresenDevWindow = require('./classes/mds_presen_dev_window');

MainMenu = require('./classes/mds_main_menu');

exist = require('./classes/mds_file').exist;

electron = require('electron');

ipc = electron.ipcMain;

MickrWindow = require('../MickrWindow.js');

MickrClient = require('../modules/MickrClient');

Tray = electron.Tray;

globalShortcut = electron.globalShortcut;

powerSaveBlocker = electron.powerSaveBlocker;

fs = require('fs');

setting = {
  "id": "main",
  "url": "ws://apps.wisdomweb.net:64260/ws/mik",
  "site": "test",
  "token": "Pad:9948"
};

client = new MickrClient(setting);

slideInfo = "";

presenDevWin = null;

win = null;

mickrWin = null;

presenWin = null;

tray = null;

tray2 = null;

global.marp.config.initialize();

opts = {
  file: null
};

ref1 = process.argv.slice(1);
for (j = 0, len = ref1.length; j < len; j++) {
  arg = ref1[j];
  break_arg = false;
  switch (arg) {
    case '--development':
    case '--dev':
      global.marp.development = true;
      break;
    default:
      if (exist(resolved_file = Path.resolve(arg))) {
        opts.file = resolved_file;
        break_arg = true;
      }
  }
  if (break_arg) {
    break;
  }
}

app.on('window-all-closed', function() {
  if (process.platform !== 'darwin' || !!MdsWindow.appWillQuit) {
    return app.quit();
  }
});

app.on('before-quit', function() {
  return MdsWindow.appWillQuit = true;
});

app.on('activate', function(e, hasVisibleWindows) {
  if (app.isReady() && !hasVisibleWindows) {
    return new MdsWindow;
  }
});

app.on('open-file', function(e, path) {
  e.preventDefault();
  opts.fileOpened = true;
  return MdsWindow.loadFromFile(path, null);
});

app.on('ready', function() {
  mickrWin = new MickrWindow();
  mickrWin.activateMainWindows();
  tray = new Tray(Path.join(__dirname, '../', 'lib', 'img', 'cloud_on.png'));
  tray.on('click', (function(_this) {
    return function(e) {
      return mickrWin.switchShowMode(tray);
    };
  })(this));
  tray2 = new Tray(Path.join(__dirname, '../', 'lib', 'img', 'ic_pause_black_24dp_2x.png'));
  tray2.on('click', (function(_this) {
    return function(e) {
      return mickrWin.switchPause();
    };
  })(this));
  global.marp.mainMenu = new MainMenu({
    development: global.marp.development
  });
  if (!opts.fileOpened) {
    if (opts.file) {
      return MdsWindow.loadFromFile(opts.file, null);
    } else {
      return win = new MdsWindow;
    }
  }
});

ipc.on('textSend', (function(_this) {
  return function(e, text) {
    var displays, electronScreen, externalDisplay, i, idx, input, k, len1, nonHTML, value;
    console.log('receive textSend');
    _this.presenDevWin = new MdsPresenDevWindow({}, {}, text);
    electronScreen = electron.screen;
    displays = electronScreen.getAllDisplays();
    externalDisplay = null;
    for (k = 0, len1 = displays.length; k < len1; k++) {
      i = displays[k];
      if (i.bounds.x !== 0 || i.bounds.y !== 0) {
        externalDisplay = i;
        break;
      }
    }
    console.log('externalDisplay = ' + externalDisplay);
    if (externalDisplay) {
      console.log(externalDisplay.bounds);
      _this.presenWin = new MdsPresenWindow({}, {
        x: externalDisplay.bounds.x + 50,
        y: externalDisplay.bounds.y + 50,
        fullscreen: true
      });
    } else {
      _this.presenWin = new MdsPresenWindow({
        width: 800,
        height: 600
      });
    }
    _this.slideInfo = text;
    nonHTML = [];
    for (idx in text) {
      value = text[idx];
      nonHTML[idx] = value.replace(/<(".*?"|'.*?'|[^'"])*?>/gi, " ");
      nonHTML[idx] = nonHTML[idx].replace(/\n/gi, "");
      nonHTML[idx] = nonHTML[idx].replace(/\s+/gi, "");
      nonHTML[idx] = nonHTML[idx].substr(0, nonHTML[idx].length - 1);
    }
    console.log(nonHTML);
    nonHTML = nonHTML.join("");
    console.log(nonHTML);
    input = [];
    return input.push(nonHTML);
  };
})(this));

ipc.on('loadUsedSlide', function() {
  var args;
  console.log('receive loadUsedSlide');
  args = [
    {
      title: 'Open',
      filters: [
        {
          name: 'Markdown files',
          extensions: ['md', 'mdown']
        }, {
          name: 'Text file',
          extensions: ['txt']
        }, {
          name: 'All files',
          extensions: ['*']
        }
      ],
      properties: ['openFile', 'createDirectory']
    }, function(fnames) {
      if (fnames == null) {
        return;
      }
      return win.browserWindow.webContents.send('sendUsedSlidePath', fnames[0]);
    }
  ];
  return dialog.showOpenDialog.apply(win, args);
});

ipc.on('goToPage', (function(_this) {
  return function(e, page) {
    console.log(page);
    return win.browserWindow.webContents.send('goToPage', page);
  };
})(this));

ipc.on('PdfExport', (function(_this) {
  return function() {
    console.log('PDF Export');
    return win.trigger('exportPdfDialog');
  };
})(this));

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsibWFpbi5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsSUFBQTs7QUFBQSxNQUFNLENBQUMsU0FBUCxNQUFNLENBQUMsT0FDTDtFQUFBLE1BQUEsRUFBUSxPQUFBLENBQVEsc0JBQVIsQ0FBUjtFQUNBLFdBQUEsRUFBYSxLQURiOzs7QUFHRixNQUFvQyxPQUFBLENBQVEsVUFBUixDQUFwQyxFQUFDLGlDQUFELEVBQWdCLGFBQWhCLEVBQXFCOztBQUNyQixJQUFBLEdBQVksT0FBQSxDQUFRLE1BQVI7O0FBQ1osU0FBQSxHQUFZLE9BQUEsQ0FBUSxzQkFBUjs7QUFDWixlQUFBLEdBQWtCLE9BQUEsQ0FBUSw2QkFBUjs7QUFDbEIsa0JBQUEsR0FBcUIsT0FBQSxDQUFRLGlDQUFSOztBQUNyQixRQUFBLEdBQVksT0FBQSxDQUFRLHlCQUFSOztBQUNYLFFBQVcsT0FBQSxDQUFRLG9CQUFSOztBQUNaLFFBQUEsR0FBWSxPQUFBLENBQVEsVUFBUjs7QUFDWixHQUFBLEdBQVksUUFBUSxDQUFDOztBQUNyQixXQUFBLEdBQWMsT0FBQSxDQUFRLG1CQUFSOztBQUNkLFdBQUEsR0FBYyxPQUFBLENBQVEsd0JBQVI7O0FBQ2QsSUFBQSxHQUFZLFFBQVEsQ0FBQzs7QUFDckIsY0FBQSxHQUFpQixRQUFRLENBQUM7O0FBQzFCLGdCQUFBLEdBQW1CLFFBQVEsQ0FBQzs7QUFDNUIsRUFBQSxHQUFZLE9BQUEsQ0FBUSxJQUFSOztBQUlaLE9BQUEsR0FDSztFQUFBLElBQUEsRUFBTSxNQUFOO0VBQ0EsS0FBQSxFQUFPLHNDQURQO0VBRUEsTUFBQSxFQUFRLE1BRlI7RUFHQSxPQUFBLEVBQVMsVUFIVDs7O0FBSUwsTUFBQSxHQUFTLElBQUksV0FBSixDQUFnQixPQUFoQjs7QUFFVCxTQUFBLEdBQVk7O0FBQ1osWUFBQSxHQUFlOztBQUNmLEdBQUEsR0FBTTs7QUFDTixRQUFBLEdBQVc7O0FBQ1gsU0FBQSxHQUFZOztBQUVaLElBQUEs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YUFDQSxHQUFHLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxJQUE5QixDQUFtQyxtQkFBbkMsRUFBd0QsTUFBTyxDQUFBLENBQUEsQ0FBL0Q7SUFGRixDQVZDOztTQWNQLE1BQU0sQ0FBQyxjQUFjLENBQUMsS0FBdEIsQ0FBNEIsR0FBNUIsRUFBaUMsSUFBakM7QUFoQnFCLENBQXhCOztBQXVCRCxHQUFHLENBQUMsRUFBSixDQUFPLFVBQVAsRUFBbUIsQ0FBQSxTQUFBLEtBQUE7U0FBQSxTQUFDLENBQUQsRUFBSSxJQUFKO0lBQ2pCLE9BQU8sQ0FBQyxHQUFSLENBQVksSUFBWjtXQUNBLEdBQUcsQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLElBQTlCLENBQW1DLFVBQW5DLEVBQStDLElBQS9DO0VBRmlCO0FBQUEsQ0FBQSxDQUFBLENBQUEsSUFBQSxDQUFuQjs7QUFJQSxHQUFHLENBQUMsRUFBSixDQUFPLFdBQVAsRUFBb0IsQ0FBQSxTQUFBLEtBQUE7U0FBQSxTQUFBO0lBQ2xCLE9BQU8sQ0FBQyxHQUFSLENBQVksWUFBWjtXQUNBLEdBQUcsQ0FBQyxPQUFKLENBQVksaUJBQVo7RUFGa0I7QUFBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLENBQXBCIiwic291cmNlc0NvbnRlbnQiOlsiZ2xvYmFsLm1hcnAgb3I9XG4gIGNvbmZpZzogcmVxdWlyZSAnLi9jbGFzc2VzL21kc19jb25maWcnXG4gIGRldmVsb3BtZW50OiBmYWxzZVxuXG57QnJvd3NlcldpbmRvdywgYXBwLCBkaWFsb2cgfSAgICAgPSByZXF1aXJlICdlbGVjdHJvbidcblBhdGggICAgICA9IHJlcXVpcmUgJ3BhdGgnXG5NZHNXaW5kb3cgPSByZXF1aXJlICcuL2NsYXNzZXMvbWRzX3dpbmRvdydcbk1kc1ByZXNlbldpbmRvdyA9IHJlcXVpcmUgJy4vY2xhc3Nlcy9tZHNfcHJlc2VuX3dpbmRvdydcbk1kc1ByZXNlbkRldldpbmRvdyA9IHJlcXVpcmUgJy4vY2xhc3Nlcy9tZHNfcHJlc2VuX2Rldl93aW5kb3cnXG5NYWluTWVudSAgPSByZXF1aXJlICcuL2NsYXNzZXMvbWRzX21haW5fbWVudSdcbntleGlzdH0gICA9IHJlcXVpcmUgJy4vY2xhc3Nlcy9tZHNfZmlsZSdcbmVsZWN0cm9uICA9IHJlcXVpcmUgJ2VsZWN0cm9uJ1xuaXBjICAgICAgID0gZWxlY3Ryb24uaXBjTWFpblxuTWlja3JXaW5kb3cgPSByZXF1aXJlICcuLi9NaWNrcldpbmRvdy5qcydcbk1pY2tyQ2xpZW50ID0gcmVxdWlyZSAnLi4vbW9kdWxlcy9NaWNrckNsaWVudCdcblRyYXkgICAgICA9IGVsZWN0cm9uLlRyYXlcbmdsb2JhbFNob3J0Y3V0ID0gZWxlY3Ryb24uZ2xvYmFsU2hvcnRjdXRcbnBvd2VyU2F2ZUJsb2NrZXIgPSBlbGVjdHJvbi5wb3dlclNhdmVCbG9ja2VyXG5mcyAgICAgICAgPSByZXF1aXJlICdmcydcblxuIyBhcHAuY29tbWFuZExpbmUuYXBwZW5kU3dpdGNoKFwiLS1lbmFibGUtZXhwZXJpbWVudGFsLXdlYi1wbGF0Zm9ybS1mZWF0dXJlc1wiKTtcbiMgYWJvdXQgcHJlc2VudGF0aW9uXG5zZXR0aW5nID1cbiAgICAgXCJpZFwiOiBcIm1haW5cIlxuICAgICBcInVybFwiOiBcIndzOi8vYXBwcy53aXNkb213ZWIubmV0OjY0MjYwL3dzL21pa1wiXG4gICAgIFwic2l0ZVwiOiBcInRlc3RcIlxuICAgICBcInRva2VuXCI6IFwiUGFkOjk5NDhcIlxuY2xpZW50ID0gbmV3IE1pY2tyQ2xpZW50KHNldHRpbmcpO1xuXG5zbGlkZUluZm8gPSBcIlwiXG5wcmVzZW5EZXZXaW4gPSBudWxsXG53aW4gPSBudWxsXG5taWNrcldpbiA9IG51bGxcbnByZXNlbldpbiA9IG51bGxcblxudHJheSA9IG51bGw7XG50cmF5MiA9IG51bGw7XG5cbiMgSW5pdGlhbGl6ZSBjb25maWdcbmdsb2JhbC5tYXJwLmNvbmZpZy5pbml0aWFsaXplKClcblxuIyBQYXJzZSBhcmd1bWVudHNcbm9wdHMgPVxuICBmaWxlOiBudWxsXG5cbmZvciBhcmcgaW4gcHJvY2Vzcy5hcmd2LnNsaWNlKDEpXG4gIGJyZWFrX2FyZyA9IGZhbHNlXG4gIHN3aXRjaCBhcmdcbiAgICB3aGVuICctLWRldmVsb3BtZW50JywgJy0tZGV2J1xuICAgICAgZ2xvYmFsLm1hcnAuZGV2ZWxvcG1lbnQgPSB0cnVlXG4gICAgZWxzZVxuICAgICAgaWYgZXhpc3QocmVzb2x2ZWRfZmlsZSA9IFBhdGgucmVzb2x2ZShhcmcpKVxuICAgICAgICBvcHRzLmZpbGUgPSByZXNvbHZlZF9maWxlXG4gICAgICAgIGJyZWFrX2FyZyA9IHRydWVcblxuICBicmVhayBpZiBicmVha19hcmdcblxuIyBBcHBsaWNhdGlvbiBldmVudHNcbmFwcC5vbiAnd2luZG93LWFsbC1jbG9zZWQnLCAtPlxuICBpZiBwcm9jZXNzLnBsYXRmb3JtICE9ICdkYXJ3aW4nIG9yICEhTWRzV2luZG93LmFwcFdpbGxRdWl0XG4gICAgIyBnbG9iYWwubWFycC5jb25maWcuc2F2ZSgpXG4gICAgYXBwLnF1aXQoKVxuXG5hcHAub24gJ2JlZm9yZS1xdWl0JywgLT5cbiAgTWRzV2luZG93LmFwcFdpbGxRdWl0ID0gdHJ1ZVxuXG5hcHAub24gJ2FjdGl2YXRlJywgKGUsIGhhc1Zpc2libGVXaW5kb3dzKSAtPlxuICBuZXcgTWRzV2luZG93IGlmIGFwcC5pc1JlYWR5KCkgYW5kIG5vdCBoYXNWaXNpYmxlV2luZG93c1xuXG5hcHAub24gJ29wZW4tZmlsZScsIChlLCBwYXRoKSAtPlxuICBlLnByZXZlbnREZWZhdWx0KClcblxuICBvcHRzLmZpbGVPcGVuZWQgPSB0cnVlXG4gIE1kc1dpbmRvdy5sb2FkRnJvbUZpbGUgcGF0aCwgbnVsbFxuXG5hcHAub24gJ3JlYWR5JywgLT5cbiAgIyBtaWNrciDjga7jgqbjgqTjg7Pjg4njgqZcbiAgbWlja3JXaW4gPSBuZXcgTWlja3JXaW5kb3coKVxuICBtaWNrcldpbi5hY3RpdmF0ZU1haW5XaW5kb3dzKClcbiAgIy8qIOODoeODi+ODpeODvOODkOODvOS4iuOBruOCouOCpOOCs+ODs+OBjOaKvOOBleOCjOOBn+WgtOWQiOOBruWHpueQhiAqL1xuICB0cmF5ID0gbmV3IFRyYXkoUGF0aC5qb2luIF9fZGlybmFtZSwgJy4uLycsJ2xpYicsICdpbWcnLCAnY2xvdWRfb24ucG5nJylcbiAgdHJheS5vbiAnY2xpY2snLCAoZSkgPT5cbiAgICBtaWNrcldpbi5zd2l0Y2hTaG93TW9kZSh0cmF5KVxuXG4gIHRyYXkyID0gbmV3IFRyYXkoUGF0aC5qb2luIF9fZGlybmFtZSwgJy4uLycsJ2xpYicsICdpbWcnLCAnaWNfcGF1c2VfYmxhY2tfMjRkcF8yeC5wbmcnKVxuICB0cmF5Mi5vbiAnY2xpY2snLCAoZSkgPT5cbiAgICBtaWNrcldpbi5zd2l0Y2hQYXVzZSgpXG5cbiAgIyDjgqLjg5fjg6rjga7jgqbjgqTjg7Pjg4njgqZcbiAgZ2xvYmFsLm1hcnAubWFpbk1lbnUgPSBuZXcgTWFpbk1lbnVcbiAgICBkZXZlbG9wbWVudDogZ2xvYmFsLm1hcnAuZGV2ZWxvcG1lbnRcblxuICB1bmxlc3Mgb3B0cy5maWxlT3BlbmVkXG4gICAgaWYgb3B0cy5maWxlXG4gICAgICBNZHNXaW5kb3cubG9hZEZyb21GaWxlIG9wdHMuZmlsZSwgbnVsbFxuICAgIGVsc2VcbiAgICAgIHdpbiA9IG5ldyBNZHNXaW5kb3dcbiAjIHJlY2VpdmUgVGV4dFxuaXBjLm9uICd0ZXh0U2VuZCcsIChlLCB0ZXh0KSA9PlxuICBjb25zb2xlLmxvZyAncmVjZWl2ZSB0ZXh0U2VuZCdcbiAgI2NvbnNvbGUubG9nIHRleHRcblxuICBAcHJlc2VuRGV2V2luPSBuZXcgTWRzUHJlc2VuRGV2V2luZG93IHt9LCB7fSwgdGV4dFxuXG4gIGVsZWN0cm9uU2NyZWVuID0gZWxlY3Ryb24uc2NyZWVuXG4gIGRpc3BsYXlzID0gZWxlY3Ryb25TY3JlZW4uZ2V0QWxsRGlzcGxheXMoKVxuICBleHRlcm5hbERpc3BsYXkgPSBudWxsXG4gIGZvciBpIGluIGRpc3BsYXlzXG4gICAgaWYgKGkuYm91bmRzLnggIT0gMCB8fCBpLmJvdW5kcy55ICE9IDApXG4gICAgICBleHRlcm5hbERpc3BsYXkgPSBpXG4gICAgICBicmVha1xuICBjb25zb2xlLmxvZyAnZXh0ZXJuYWxEaXNwbGF5ID0gJyArIGV4dGVybmFsRGlzcGxheVxuICAj44CA5aSW6YOo44OH44Kj44K544OX44Os44Kk44GM5a2Y5Zyo44GZ44KL5aC05ZCIXG4gIGlmIChleHRlcm5hbERpc3BsYXkpXG4gICAgY29uc29sZS5sb2cgZXh0ZXJuYWxEaXNwbGF5LmJvdW5kc1xuICAgIEBwcmVzZW5XaW4gPSBuZXcgTWRzUHJlc2VuV2luZG93IHt9LFxuICAgICAgeDogZXh0ZXJuYWxEaXNwbGF5LmJvdW5kcy54ICsgNTBcbiAgICAgIHk6IGV4dGVybmFsRGlzcGxheS5ib3VuZHMueSArIDUwXG4gICAgICBmdWxsc2NyZWVuOiB0cnVlXG4gICMg5aSW6YOo44OH44Kj44K544OX44Os44Kk44GM5a2Y5Zyo44GX44Gq44GE5aC05ZCIXG4gIGVsc2VcbiAgICBAcHJlc2VuV2luID0gbmV3IE1kc1ByZXNlbldpbmRvd1xuICAgICAgd2lkdGg6ODAwXG4gICAgICBoZWlnaHQ6IDYwMFxuICAjIHRleHQg44Gr44Gv44CBc2xpZGVfd3JhcHBlcuOBrkhUTUzopoHntKDjgYxpZOmghuOBq+WFpeOBo+OBpuOBhOOCi1xuICBAc2xpZGVJbmZvID0gdGV4dFxuICBub25IVE1MID0gW11cblxuICAjIGh0bWzjgr/jgrDliYrpmaQgJiDmloflrZfliJfjga7lvaLjgpLmlbTjgYjjgotcbiAgZm9yIGlkeCwgdmFsdWUgb2YgdGV4dFxuICAgIG5vbkhUTUxbaWR4XSA9IHZhbHVlLnJlcGxhY2UoLzwoXCIuKj9cInwnLio/J3xbXidcIl0pKj8+L2dpLCBcIiBcIikgICAgIyBIVE1M44K/44Kw5raI5Y67XG4gICAgbm9uSFRNTFtpZHhdID0gbm9uSFRNTFtpZHhdLnJlcGxhY2UoL1xcbi9naSwgXCJcIikgICMg5pS56KGM5paH5a2X44Gu5YmK6ZmkXG4gICAgbm9uSFRNTFtpZHhdID0gbm9uSFRNTFtpZHhdLnJlcGxhY2UoL1xccysvZ2ksIFwiXCIpICMg56m655m944Gu5YmK6ZmkXG4gICAgbm9uSFRNTFtpZHhdID0gbm9uSFRNTFtpZHhdLnN1YnN0cigwLCBub25IVE1MW2lkeF0ubGVuZ3RoLTEpICAjIOacq+WwvuOBq+ODmuODvOOCuOaVsOOBjOWFpeOCi+OBruOBp+OAgeacq+WwvuOCkuWJiumZpFxuXG4gICMgaHRtbOOCv+OCsOOCkuWQq+OBvuOBquOBhOacrOaWh1xuICBjb25zb2xlLmxvZyBub25IVE1MXG4gICMg44Gd44KM44Ge44KM44Gu44K544Op44Kk44OJ44Gu44OG44Kt44K544OI44KS57WQ5ZCI44GX44CB44Oq44K544OI44Gr5LiA44Gk44Gu6KaB57Sg44Go44GX44Gm5YWl44KM44GmXG4gICMg44CB44Gd44KM44KScHl0aG9u44Gr5rih44GZXG4gIG5vbkhUTUwgPSBub25IVE1MLmpvaW4oXCJcIilcbiAgY29uc29sZS5sb2cgbm9uSFRNTFxuICBpbnB1dCA9IFtdXG4gIGlucHV0LnB1c2gobm9uSFRNTClcblxuIGlwYy5vbiAnbG9hZFVzZWRTbGlkZScsICgpIC0+XG4gICAgY29uc29sZS5sb2cgJ3JlY2VpdmUgbG9hZFVzZWRTbGlkZSdcbiAgICBhcmdzID0gW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHRpdGxlOiAnT3BlbidcbiAgICAgICAgICAgIGZpbHRlcnM6IFtcbiAgICAgICAgICAgICAgeyBuYW1lOiAnTWFya2Rvd24gZmlsZXMnLCBleHRlbnNpb25zOiBbJ21kJywgJ21kb3duJ10gfVxuICAgICAgICAgICAgICB7IG5hbWU6ICdUZXh0IGZpbGUnLCBleHRlbnNpb25zOiBbJ3R4dCddIH1cbiAgICAgICAgICAgICAgeyBuYW1lOiAnQWxsIGZpbGVzJywgZXh0ZW5zaW9uczogWycqJ10gfVxuICAgICAgICAgICAgXVxuICAgICAgICAgICAgcHJvcGVydGllczogWydvcGVuRmlsZScsICdjcmVhdGVEaXJlY3RvcnknXVxuICAgICAgICAgIH1cbiAgICAgICAgICAoZm5hbWVzKSAtPlxuICAgICAgICAgICAgcmV0dXJuIHVubGVzcyBmbmFtZXM/XG4gICAgICAgICAgICB3aW4uYnJvd3NlcldpbmRvdy53ZWJDb250ZW50cy5zZW5kICdzZW5kVXNlZFNsaWRlUGF0aCcsIGZuYW1lc1swXVxuICAgICAgICBdXG4gICAgZGlhbG9nLnNob3dPcGVuRGlhbG9nLmFwcGx5IHdpbiwgYXJnc1xuXG5cbiMgaXBjLm9uICdyZXF1ZXN0U2xpZGVJbmZvJywgKCkgPT5cbiMgICBjb25zb2xlLmxvZyAncmVjZWl2ZSByZXF1ZXN0U2xpZGVJbmZvJ1xuIyAgIEBwcmVzZW5EZXZXaW4ud2ViQ29udGVudHMuc2VuZCAnc2VuZFNsaWRlSW5mbycsIEBzbGlkZUluZm9cblxuaXBjLm9uICdnb1RvUGFnZScsIChlLCBwYWdlKSA9PlxuICBjb25zb2xlLmxvZyBwYWdlXG4gIHdpbi5icm93c2VyV2luZG93LndlYkNvbnRlbnRzLnNlbmQgJ2dvVG9QYWdlJywgcGFnZVxuXG5pcGMub24gJ1BkZkV4cG9ydCcsICgpID0+XG4gIGNvbnNvbGUubG9nICdQREYgRXhwb3J0J1xuICB3aW4udHJpZ2dlciAnZXhwb3J0UGRmRGlhbG9nJ1xuIyBpcGMub24gJ1ByZXNlbnRhdGlvbicsICgpID0+XG4jICAgcHJlc2VuRGV2V2luID0gbmV3IE1kc1dpbmRvd1xuIyAgIHByZXNlbkRldldpbi53ZWJDb250ZW50cy5zZW5kICdpbml0aWFsaXplJ1xuIyAgIHByZXNlbkRldldpbi5vcGVuRGV2VG9vbHMoKVxuXG4iXX0=
