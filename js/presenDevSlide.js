var MickrClient, Path, clsMarkdown, ipc, resolvePathFromMarp;

clsMarkdown = require('./classes/mds_markdown');

ipc = require('electron').ipcRenderer;

Path = require('path');

MickrClient = require('../modules/MickrClient');

resolvePathFromMarp = function(path) {
  if (path == null) {
    path = './';
  }
  return Path.resolve(__dirname, '../', path);
};

document.addEventListener('DOMContentLoaded', function() {
  var changeSlide, client, selectedIndex, setting, slideHTML, slideList;
  setting = {
    "id": "presenDevSlide",
    "url": "ws://apps.wisdomweb.net:64260/ws/mik",
    "site": "test",
    "token": "Pad:9948"
  };
  client = new MickrClient(setting);
  changeSlide = function(page) {
    client.send("goToPage", {
      "to": "presenSlide",
      "body": {
        "content": page
      }
    });
    return client.send("changeComment", {
      "to": "presenDevIndex",
      "body": {
        "content": page
      }
    });
  };
  slideHTML = "";
  slideList = [];
  selectedIndex = 0;
  return (function($) {
    var Markdown, applyCurrentPage, applyScreenSize, applySlideSize, getCSSvar, getScreenSize, getSlideSize, render, setImageDirectory, setStyle, themes;
    $("[data-marp-path-resolver]").each(function() {
      var j, len, ref, results, target;
      ref = $(this).attr('data-marp-path-resolver').split(/\s+/);
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        target = ref[j];
        results.push($(this).attr(target, resolvePathFromMarp($(this).attr(target))));
      }
      return results;
    });
    Markdown = new clsMarkdown({
      afterRender: clsMarkdown.generateAfterRender($)
    });
    themes = {};
    themes.current = function() {
      return $('#theme-css').attr('href');
    };
    themes["default"] = themes.current();
    themes.apply = function(path) {
      var toApply;
      if (path == null) {
        path = null;
      }
      toApply = resolvePathFromMarp(path || themes["default"]);
      if (toApply !== themes.current()) {
        $('#theme-css').attr('href', toApply);
        setTimeout(applyScreenSize, 20);
        return toApply.match(/([^\/]+)\.css$/)[1];
      }
      return false;
    };
    setStyle = function(identifier, css) {
      var elm, id;
      id = "mds-" + identifier + "Style";
      elm = $("#" + id);
      if (elm.length <= 0) {
        elm = $("<style id=\"" + id + "\"></style>").appendTo(document.head);
      }
      return elm.text(css);
    };
    getCSSvar = function(prop) {
      return document.defaultView.getComputedStyle(document.body).getPropertyValue(prop);
    };
    getSlideSize = function() {
      var size;
      size = {
        w: +getCSSvar('--slide-width'),
        h: +getCSSvar('--slide-height')
      };
      size.ratio = size.w / size.h;
      return size;
    };
    applySlideSize = function(width, height) {
      setStyle('slideSize', "body {\n  --slide-width: " + (width || 'inherit') + ";\n  --slide-height: " + (height || 'inherit') + ";\n}");
      return applyScreenSize();
    };
    getScreenSize = function() {
      var previewMargin, size;
      size = {
        w: document.documentElement.clientWidth,
        h: document.documentElement.clientHeight
      };
      previewMargin = +getCSSvar('--preview-margin');
      size.ratio = (size.w - previewMargin * 2) / (size.h - previewMargin * 2);
      return size;
    };
    applyScreenSize = function() {
      var size;
      size = getScreenSize();
      setStyle('screenSize', "body { --screen-width: " + size.w + "; --screen-height: " + size.h + "; }");
      return $('#container').toggleClass('height-base', size.ratio > getSlideSize().ratio);
    };
    applyCurrentPage = function(page) {
      return setStyle('currentPage', "@media not print {\n  body.slide-view.screen .slide_wrapper:not(:nth-of-type(" + page + ")) {\n    width: 0 !important;\n    height: 0 !important;\n    border: none !important;\n    box-shadow: none !important;\n  }\n}");
    };
    render = function(md) {
      var i, slideOuterHTML, value;
      console.log('call render');
      applySlideSize(md.settings.getGlobal('width'), md.settings.getGlobal('height'));
      md.changedTheme = themes.apply(md.settings.getGlobal('theme'));
      slideOuterHTML = [];
      for (i in slideList) {
        value = slideList[i];
        slideOuterHTML.push(value.outerHTML);
      }
      $('#markdown').html(slideOuterHTML.join(' '));
      $('.slide_wrapper').css('backgroundColor', '');
      $('#1').css('backgroundColor', '#ffe3b4');
      changeSlide(1);
      $('.slide_wrapper').on('click', function() {
        $('.slide_wrapper').css('backgroundColor', '');
        $(this).css('backgroundColor', '#ffe3b4');
        selectedIndex = slideList.indexOf(this);
        $("html,body").animate({
          scrollTop: $(this).offset().top
        });
        return changeSlide($(this).attr('id'));
      });
      ipc.sendToHost('rendered', md);
      if (md.rulerChanged) {
        ipc.sendToHost('rulerChanged', md.rulers);
      }
      if (md.changedTheme) {
        return ipc.sendToHost('themeChanged', md.changedTheme);
      }
    };
    setImageDirectory = function(dir) {
      return $('head > base').attr('href', dir || './');
    };
    ipc.on('render', function(e, md) {
      return render(Markdown.parse(md));
    });
    ipc.on('currentPage', function(e, page) {
      return applyCurrentPage(page);
    });
    ipc.on('setClass', function(e, classes) {
      return $('body').attr('class', classes);
    });
    ipc.on('setImageDirectory', function(e, dir) {
      return setImageDirectory(dir);
    });
    ipc.on('requestPdfOptions', function(e, opts) {
      return sendPdfOptions(opts || {});
    });
    ipc.on('unfreeze', function() {
      return $('body').removeClass('to-pdf');
    });
    $(document).on('click', 'a', function(e) {
      e.preventDefault();
      return ipc.sendToHost('linkTo', $(e.currentTarget).attr('href'));
    });
    $(document).keydown(function(e) {
      var nextPageId, nextPageIndex;
      if (e.keyCode === 38) {
        console.log('up key');
        nextPageIndex = (selectedIndex + (slideList.length - 1)) % slideList.length;
        nextPageId = slideList[nextPageIndex].id;
        console.log('next id = ' + nextPageId);
        $('.slide_wrapper').css('backgroundColor', '');
        $("#" + nextPageId).css('backgroundColor', '#ffe3b4');
        selectedIndex = nextPageIndex;
        changeSlide(nextPageId);
        $("html,body").animate({
          scrollTop: $("#" + nextPageId).offset().top
        });
      }
      if (e.keyCode === 40) {
        console.log('down key');
        nextPageIndex = (selectedIndex + 1) % slideList.length;
        nextPageId = slideList[nextPageIndex].id;
        console.log('next id = ' + nextPageId);
        $('.slide_wrapper').css('backgroundColor', '');
        $("#" + nextPageId).css('backgroundColor', '#ffe3b4');
        selectedIndex = nextPageIndex;
        changeSlide(nextPageId);
        return $("html,body").animate({
          scrollTop: $("#" + nextPageId).offset().top
        });
      }
    });
    $(window).resize(function(e) {
      return applyScreenSize();
    });
    applyScreenSize();
    ipc.on('requestSlideInfo', (function(_this) {
      return function() {
        var markdownBody;
        console.log('receive requestSlideInfo');
        markdownBody = document.querySelector('.markdown-body');
        ipc.sendToHost('sendSlideInfo', markdownBody.innerHTML);
        console.log(markdownBody.innerHTML);
        return console.log('send sendSlideInfo');
      };
    })(this));
    ipc.sendToHost('requestSlideHTML', (function(_this) {
      return function() {
        return console.log('send requestSlideHTML');
      };
    })(this));
    ipc.on('setSlide', (function(_this) {
      return function(e, text) {
        console.log('receive setSlide');
        console.log(text);
        slideHTML = text.join("");
        document.querySelector('.markdown-body').innerHTML = slideHTML;
        return $('.slide_wrapper').each(function(idx, elem) {
          return slideList.push(elem);
        });
      };
    })(this));
    $('.markdown-body').sortable({
      'opacity': 0.5
    });
    $('.markdown-body').disableSelection();
    return $(document).on('sortstop', '.markdown-body', function() {
      console.log('sort finished');
      slideList = [];
      return $('.slide_wrapper').each(function(idx, elem) {
        return slideList.push(elem);
      });
    });
  })($);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJlc2VuRGV2U2xpZGUuanMiLCJzb3VyY2VzIjpbInByZXNlbkRldlNsaWRlLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBOztBQUFBLFdBQUEsR0FBYyxPQUFBLENBQVEsd0JBQVI7O0FBQ2QsR0FBQSxHQUFjLE9BQUEsQ0FBUSxVQUFSLENBQW1CLENBQUM7O0FBQ2xDLElBQUEsR0FBYyxPQUFBLENBQVEsTUFBUjs7QUFDZCxXQUFBLEdBQWMsT0FBQSxDQUFRLHdCQUFSOztBQUVkLG1CQUFBLEdBQXNCLFNBQUMsSUFBRDs7SUFBQyxPQUFPOztTQUFTLElBQUksQ0FBQyxPQUFMLENBQWEsU0FBYixFQUF3QixLQUF4QixFQUErQixJQUEvQjtBQUFqQjs7QUFFdEIsUUFBUSxDQUFDLGdCQUFULENBQTBCLGtCQUExQixFQUE4QyxTQUFBO0FBQzVDLE1BQUE7RUFBQSxPQUFBLEdBQ0M7SUFBQSxJQUFBLEVBQU0sZ0JBQU47SUFDQSxLQUFBLEVBQU8sc0NBRFA7SUFFQSxNQUFBLEVBQVEsTUFGUjtJQUdBLE9BQUEsRUFBUyxVQUhUOztFQUlELE1BQUEsR0FBUyxJQUFJLFdBQUosQ0FBZ0IsT0FBaEI7RUFFVCxXQUFBLEdBQWMsU0FBQyxJQUFEO0lBQ1osTUFBTSxDQUFDLElBQVAsQ0FBWSxVQUFaLEVBQXdCO01BQ3RCLElBQUEsRUFBTSxhQURnQjtNQUV0QixNQUFBLEVBQ0U7UUFBQSxTQUFBLEVBQVcsSUFBWDtPQUhvQjtLQUF4QjtXQUtBLE1BQU0sQ0FBQyxJQUFQLENBQVksZUFBWixFQUE2QjtNQUMzQixJQUFBLEVBQU0sZ0JBRHFCO01BRTNCLE1BQUEsRUFDRTtRQUFBLFNBQUEsRUFBVyxJQUFYO09BSHlCO0tBQTdCO0VBTlk7RUFjZCxTQUFBLEdBQVk7RUFDWixTQUFBLEdBQVk7RUFFWixhQUFBLEdBQWdCO1NBRWIsQ0FBQSxTQUFDLENBQUQ7QUFFRCxRQUFBO0lBQUEsQ0FBQSxDQUFFLDJCQUFGLENBQThCLENBQUMsSUFBL0IsQ0FB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QUEsQ0FBQSxDQUFBLElBQUEsQ0FBbkI7SUFXQSxDQUFBLENBQUUsZ0JBQUYsQ0FBbUIsQ0FBQyxRQUFwQixDQUE2QjtNQUMzQixTQUFBLEVBQVcsR0FEZ0I7S0FBN0I7SUFHQSxDQUFBLENBQUUsZ0JBQUYsQ0FBbUIsQ0FBQyxnQkFBcEIsQ0FBQTtXQUNBLENBQUEsQ0FBRSxRQUFGLENBQVcsQ0FBQyxFQUFaLENBQWUsVUFBZixFQUEyQixnQkFBM0IsRUFBNkMsU0FBQTtNQUMzQyxPQUFPLENBQUMsR0FBUixDQUFZLGVBQVo7TUFFQSxTQUFBLEdBQVk7YUFDWixDQUFBLENBQUUsZ0JBQUYsQ0FBbUIsQ0FBQyxJQUFwQixDQUF5QixTQUFDLEdBQUQsRUFBTSxJQUFOO2VBQ3hCLFNBQVMsQ0FBQyxJQUFWLENBQWUsSUFBZjtNQUR3QixDQUF6QjtJQUoyQyxDQUE3QztFQXJMQyxDQUFBLENBQUgsQ0FBSSxDQUFKO0FBM0I0QyxDQUE5QyIsInNvdXJjZXNDb250ZW50IjpbImNsc01hcmtkb3duID0gcmVxdWlyZSAnLi9jbGFzc2VzL21kc19tYXJrZG93bidcbmlwYyAgICAgICAgID0gcmVxdWlyZSgnZWxlY3Ryb24nKS5pcGNSZW5kZXJlclxuUGF0aCAgICAgICAgPSByZXF1aXJlICdwYXRoJ1xuTWlja3JDbGllbnQgPSByZXF1aXJlICcuLi9tb2R1bGVzL01pY2tyQ2xpZW50J1xuXG5yZXNvbHZlUGF0aEZyb21NYXJwID0gKHBhdGggPSAnLi8nKSAtPiBQYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4vJywgcGF0aClcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciAnRE9NQ29udGVudExvYWRlZCcsIC0+XG4gIHNldHRpbmcgPVxuICAgXCJpZFwiOiBcInByZXNlbkRldlNsaWRlXCJcbiAgIFwidXJsXCI6IFwid3M6Ly9hcHBzLndpc2RvbXdlYi5uZXQ6NjQyNjAvd3MvbWlrXCJcbiAgIFwic2l0ZVwiOiBcInRlc3RcIlxuICAgXCJ0b2tlblwiOiBcIlBhZDo5OTQ4XCJcbiAgY2xpZW50ID0gbmV3IE1pY2tyQ2xpZW50KHNldHRpbmcpO1xuXG4gIGNoYW5nZVNsaWRlID0gKHBhZ2UpIC0+XG4gICAgY2xpZW50LnNlbmQgXCJnb1RvUGFnZVwiLCB7XG4gICAgICBcInRvXCI6IFwicHJlc2VuU2xpZGVcIixcbiAgICAgIFwiYm9keVwiOlxuICAgICAgICBcImNvbnRlbnRcIjogcGFnZVxuICAgIH1cbiAgICBjbGllbnQuc2VuZCBcImNoYW5nZUNvbW1lbnRcIiwge1xuICAgICAgXCJ0b1wiOiBcInByZXNlbkRldkluZGV4XCIsXG4gICAgICBcImJvZHlcIjpcbiAgICAgICAgXCJjb250ZW50XCI6IHBhZ2VcbiAgICB9XG5cblxuXG4gIHNsaWRlSFRNTCA9IFwiXCJcbiAgc2xpZGVMaXN0ID0gW11cbiAgIyBzbGlkZUxpc3Tjga7kvZXnlarnm67jga7opoHntKDjgYznj77lnKjpgbjmip7jgZXjgozjgabjgYTjgovjgYtcbiAgc2VsZWN0ZWRJbmRleCA9IDBcblxuICBkbyAoJCkgLT5cbiAgICAjIEZpcnN0LCByZXNvbHZlIE1hcnAgcmVzb3VyY2VzIHBhdGhcbiAgICAkKFwiW2RhdGEtbWFycC1wYXRoLXJlc29sdmVyXVwiKS5lYWNoIC0+XG4gICAgICBmb3IgdGFyZ2V0IGluICQoQCkuYXR0cignZGF0YS1tYXJwLXBhdGgtcmVzb2x2ZXInKS5zcGxpdCgvXFxzKy8pXG4gICAgICAgICQoQCkuYXR0cih0YXJnZXQsIHJlc29sdmVQYXRoRnJvbU1hcnAoJChAKS5hdHRyKHRhcmdldCkpKVxuXG4gICAgTWFya2Rvd24gPSBuZXcgY2xzTWFya2Rvd24oeyBhZnRlclJlbmRlcjogY2xzTWFya2Rvd24uZ2VuZXJhdGVBZnRlclJlbmRlcigkKSB9KVxuXG4gICAgdGhlbWVzID0ge31cbiAgICB0aGVtZXMuY3VycmVudCA9IC0+ICQoJyN0aGVtZS1jc3MnKS5hdHRyKCdocmVmJylcbiAgICB0aGVtZXMuZGVmYXVsdCA9IHRoZW1lcy5jdXJyZW50KClcbiAgICB0aGVtZXMuYXBwbHkgPSAocGF0aCA9IG51bGwpIC0+XG4gICAgICB0b0FwcGx5ID0gcmVzb2x2ZVBhdGhGcm9tTWFycChwYXRoIHx8IHRoZW1lcy5kZWZhdWx0KVxuXG4gICAgICBpZiB0b0FwcGx5IGlzbnQgdGhlbWVzLmN1cnJlbnQoKVxuICAgICAgICAkKCcjdGhlbWUtY3NzJykuYXR0cignaHJlZicsIHRvQXBwbHkpXG4gICAgICAgIHNldFRpbWVvdXQgYXBwbHlTY3JlZW5TaXplLCAyMFxuXG4gICAgICAgIHJldHVybiB0b0FwcGx5Lm1hdGNoKC8oW15cXC9dKylcXC5jc3MkLylbMV1cbiAgICAgIGZhbHNlXG5cbiAgICBzZXRTdHlsZSA9IChpZGVudGlmaWVyLCBjc3MpIC0+XG4gICAgICBpZCAgPSBcIm1kcy0je2lkZW50aWZpZXJ9U3R5bGVcIlxuICAgICAgZWxtID0gJChcIiMje2lkfVwiKVxuICAgICAgZWxtID0gJChcIjxzdHlsZSBpZD1cXFwiI3tpZH1cXFwiPjwvc3R5bGU+XCIpLmFwcGVuZFRvKGRvY3VtZW50LmhlYWQpIGlmIGVsbS5sZW5ndGggPD0gMFxuICAgICAgZWxtLnRleHQoY3NzKVxuXG4gICAgZ2V0Q1NTdmFyID0gKHByb3ApIC0+IGRvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUoZG9jdW1lbnQuYm9keSkuZ2V0UHJvcGVydHlWYWx1ZShwcm9wKVxuXG4gICAgZ2V0U2xpZGVTaXplID0gLT5cbiAgICAgIHNpemUgPVxuICAgICAgICB3OiArZ2V0Q1NTdmFyICctLXNsaWRlLXdpZHRoJ1xuICAgICAgICBoOiArZ2V0Q1NTdmFyICctLXNsaWRlLWhlaWdodCdcblxuICAgICAgc2l6ZS5yYXRpbyA9IHNpemUudyAvIHNpemUuaFxuICAgICAgc2l6ZVxuXG4gICAgYXBwbHlTbGlkZVNpemUgPSAod2lkdGgsIGhlaWdodCkgLT5cbiAgICAgIHNldFN0eWxlICdzbGlkZVNpemUnLFxuICAgICAgICBcIlwiXCJcbiAgICAgICAgYm9keSB7XG4gICAgICAgICAgLS1zbGlkZS13aWR0aDogI3t3aWR0aCB8fCAnaW5oZXJpdCd9O1xuICAgICAgICAgIC0tc2xpZGUtaGVpZ2h0OiAje2hlaWdodCB8fCAnaW5oZXJpdCd9O1xuICAgICAgICB9XG4gICAgICAgIFwiXCJcIlxuICAgICAgYXBwbHlTY3JlZW5TaXplKClcblxuICAgIGdldFNjcmVlblNpemUgPSAtPlxuICAgICAgc2l6ZSA9XG4gICAgICAgIHc6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aFxuICAgICAgICBoOiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0XG5cbiAgICAgIHByZXZpZXdNYXJnaW4gPSArZ2V0Q1NTdmFyICctLXByZXZpZXctbWFyZ2luJ1xuICAgICAgc2l6ZS5yYXRpbyA9IChzaXplLncgLSBwcmV2aWV3TWFyZ2luICogMikgLyAoc2l6ZS5oIC0gcHJldmlld01hcmdpbiAqIDIpXG4gICAgICBzaXplXG5cbiAgICBhcHBseVNjcmVlblNpemUgPSAtPlxuICAgICAgc2l6ZSA9IGdldFNjcmVlblNpemUoKVxuICAgICAgc2V0U3R5bGUgJ3NjcmVlblNpemUnLCBcImJvZHkgeyAtLXNjcmVlbi13aWR0aDogI3tzaXplLnd9OyAtLXNjcmVlbi1oZWlnaHQ6ICN7c2l6ZS5ofTsgfVwiXG4gICAgICAkKCcjY29udGFpbmVyJykudG9nZ2xlQ2xhc3MgJ2hlaWdodC1iYXNlJywgc2l6ZS5yYXRpbyA+IGdldFNsaWRlU2l6ZSgpLnJhdGlvXG5cbiAgICAjIOODmuODvOOCuOeVquWPt+OCkuWPl+OBkeWPluOBo+OBn+OBguOBqOOAgeePvuWcqOOBruODmuODvOOCuOS7peWkluOBruODmuODvOOCuOOBruOCueODqeOCpOODieOCkumdnuihqOekuuOBq+OBmeOCi1xuICAgICMg44Gf44Gg44GX44CB6Z2e44OX44Oq44Oz44OI54q25oWL44Gu5pmC6ZmQ5a6aXG4gICAgYXBwbHlDdXJyZW50UGFnZSA9IChwYWdlKSAtPlxuICAgICAgc2V0U3R5bGUgJ2N1cnJlbnRQYWdlJyxcbiAgICAgICAgXCJcIlwiXG4gICAgICAgIEBtZWRpYSBub3QgcHJpbnQge1xuICAgICAgICAgIGJvZHkuc2xpZGUtdmlldy5zY3JlZW4gLnNsaWRlX3dyYXBwZXI6bm90KDpudGgtb2YtdHlwZSgje3BhZ2V9KSkge1xuICAgICAgICAgICAgd2lkdGg6IDAgIWltcG9ydGFudDtcbiAgICAgICAgICAgIGhlaWdodDogMCAhaW1wb3J0YW50O1xuICAgICAgICAgICAgYm9yZGVyOiBub25lICFpbXBvcnRhbnQ7XG4gICAgICAgICAgICBib3gtc2hhZG93OiBub25lICFpbXBvcnRhbnQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFwiXCJcIlxuICAgICMgcHJlc2VuRGV255S76Z2i44Gn44Gv44Gv44GY44KB44Gr5LiA5Zue44Gg44GR5ZG844Gw44KM44KLXG4gICAgcmVuZGVyID0gKG1kKSAtPlxuICAgICAgY29uc29sZS5sb2cgJ2NhbGwgcmVuZGVyJ1xuICAgICAgYXBwbHlTbGlkZVNpemUgbWQuc2V0dGluZ3MuZ2V0R2xvYmFsKCd3aWR0aCcpLCBtZC5zZXR0aW5ncy5nZXRHbG9iYWwoJ2hlaWdodCcpXG4gICAgICBtZC5jaGFuZ2VkVGhlbWUgPSB0aGVtZXMuYXBwbHkgbWQuc2V0dGluZ3MuZ2V0R2xvYmFsKCd0aGVtZScpXG4gICAgICAjICQoJyNtYXJrZG93bicpLmh0bWwoc2xpZGVIVE1MKVxuXG4gICAgICAjIHNsaWRlTGlzdOimgee0oOOBneOCjOOBnuOCjOOBi+OCiW91dGVySFRNTOOCkuWPluOCiuWHuuOBl+ODquOCueODiOOBq+agvOe0jVxuICAgICAgc2xpZGVPdXRlckhUTUwgPSBbXVxuICAgICAgZm9yIGksIHZhbHVlIG9mIHNsaWRlTGlzdFxuICAgICAgICBzbGlkZU91dGVySFRNTC5wdXNoIHZhbHVlLm91dGVySFRNTFxuXG4gICAgICAkKCcjbWFya2Rvd24nKS5odG1sKHNsaWRlT3V0ZXJIVE1MLmpvaW4oJyAnKSlcblxuICAgICAgIyDjga/jgZjjgoHjga7jgrnjg6njgqTjg4njga7oibLjgpLlpInjgYjjgabjgYrjgY3jgIHjgZ3jga7jg5rjg7zjgrjjgYzpgbjmip7jgZXjgozjgabjgYTjgovjgZPjgajjgpLnpLrjgZlcbiAgICAgICQoJy5zbGlkZV93cmFwcGVyJykuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCAnJylcbiAgICAgICQoJyMxJykuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCAnI2ZmZTNiNCcpXG4gICAgICBjaGFuZ2VTbGlkZSgxKVxuXG4gICAgICAjIOaKvOOBleOCjOOBn3NsaWRlX3dyYXBwZXLjga5pZOOCkumAgeS/oeOBl+OBpuODmuODvOOCuOmBt+enu1xuICAgICAgJCgnLnNsaWRlX3dyYXBwZXInKS5vbiAnY2xpY2snLCAoKSAtPlxuICAgICAgICAjIOmBuOaKnuOBleOCjOOBn+OCueODqeOCpOODieOBruiJsuOCkuWkieabtOOBl+OAgeOAgOODmuODvOOCuOmBt+enu+OBleOBm+OCi1xuICAgICAgICAkKCcuc2xpZGVfd3JhcHBlcicpLmNzcygnYmFja2dyb3VuZENvbG9yJywgJycpXG4gICAgICAgICQodGhpcykuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCAnI2ZmZTNiNCcpXG4gICAgICAgIHNlbGVjdGVkSW5kZXggPSBzbGlkZUxpc3QuaW5kZXhPZih0aGlzKVxuICAgICAgICAkKFwiaHRtbCxib2R5XCIpLmFuaW1hdGUoe3Njcm9sbFRvcDokKHRoaXMpLm9mZnNldCgpLnRvcH0pO1xuICAgICAgICAjIOODmuODvOOCuOenu+WLleODoeODg+OCu+ODvOOCuOmAgeS/oVxuICAgICAgICAjaXBjLnNlbmRUb0hvc3QgJ2dvVG9QYWdlJywgJCh0aGlzKS5hdHRyKCdpZCcpXG4gICAgICAgIGNoYW5nZVNsaWRlKCQodGhpcykuYXR0cignaWQnKSlcblxuICAgICAgaXBjLnNlbmRUb0hvc3QgJ3JlbmRlcmVkJywgbWRcbiAgICAgIGlwYy5zZW5kVG9Ib3N0ICdydWxlckNoYW5nZWQnLCBtZC5ydWxlcnMgaWYgbWQucnVsZXJDaGFuZ2VkXG4gICAgICBpcGMuc2VuZFRvSG9zdCAndGhlbWVDaGFuZ2VkJywgbWQuY2hhbmdlZFRoZW1lIGlmIG1kLmNoYW5nZWRUaGVtZVxuICAgIHNldEltYWdlRGlyZWN0b3J5ID0gKGRpcikgLT4gJCgnaGVhZCA+IGJhc2UnKS5hdHRyKCdocmVmJywgZGlyIHx8ICcuLycpXG5cbiAgICBpcGMub24gJ3JlbmRlcicsIChlLCBtZCkgLT4gcmVuZGVyKE1hcmtkb3duLnBhcnNlKG1kKSlcbiAgICBpcGMub24gJ2N1cnJlbnRQYWdlJywgKGUsIHBhZ2UpIC0+IGFwcGx5Q3VycmVudFBhZ2UgcGFnZVxuICAgIGlwYy5vbiAnc2V0Q2xhc3MnLCAoZSwgY2xhc3NlcykgLT4gJCgnYm9keScpLmF0dHIgJ2NsYXNzJywgY2xhc3Nlc1xuICAgIGlwYy5vbiAnc2V0SW1hZ2VEaXJlY3RvcnknLCAoZSwgZGlyKSAtPiBzZXRJbWFnZURpcmVjdG9yeShkaXIpXG4gICAgaXBjLm9uICdyZXF1ZXN0UGRmT3B0aW9ucycsIChlLCBvcHRzKSAtPiBzZW5kUGRmT3B0aW9ucyhvcHRzIHx8IHt9KVxuICAgIGlwYy5vbiAndW5mcmVlemUnLCAtPiAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ3RvLXBkZicpXG5cblxuXG4gICAgIyBJbml0aWFsaXplXG4gICAgJChkb2N1bWVudCkub24gJ2NsaWNrJywgJ2EnLCAoZSkgLT5cbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgaXBjLnNlbmRUb0hvc3QgJ2xpbmtUbycsICQoZS5jdXJyZW50VGFyZ2V0KS5hdHRyKCdocmVmJylcblxuICAgICQoZG9jdW1lbnQpLmtleWRvd24gKGUpIC0+XG4gICAgICBpZiBlLmtleUNvZGUgPT0gMzhcbiAgICAgICAgY29uc29sZS5sb2cgJ3VwIGtleSdcbiAgICAgICAgbmV4dFBhZ2VJbmRleCA9IChzZWxlY3RlZEluZGV4ICsgKHNsaWRlTGlzdC5sZW5ndGgtMSkpICUgc2xpZGVMaXN0Lmxlbmd0aFxuICAgICAgICBuZXh0UGFnZUlkICAgID0gc2xpZGVMaXN0W25leHRQYWdlSW5kZXhdLmlkXG4gICAgICAgIGNvbnNvbGUubG9nICduZXh0IGlkID0gJyArIG5leHRQYWdlSWRcbiAgICAgICAgJCgnLnNsaWRlX3dyYXBwZXInKS5jc3MoJ2JhY2tncm91bmRDb2xvcicsICcnKVxuICAgICAgICAkKFwiIyN7bmV4dFBhZ2VJZH1cIikuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCAnI2ZmZTNiNCcpXG4gICAgICAgIHNlbGVjdGVkSW5kZXggPSBuZXh0UGFnZUluZGV4XG4gICAgICAgICNpcGMuc2VuZFRvSG9zdCAnZ29Ub1BhZ2UnLCBuZXh0UGFnZUlkXG4gICAgICAgIGNoYW5nZVNsaWRlKG5leHRQYWdlSWQpXG4gICAgICAgICQoXCJodG1sLGJvZHlcIikuYW5pbWF0ZSh7c2Nyb2xsVG9wOiQoXCIjI3tuZXh0UGFnZUlkfVwiKS5vZmZzZXQoKS50b3B9KTtcblxuICAgICAgaWYgZS5rZXlDb2RlID09IDQwXG4gICAgICAgIGNvbnNvbGUubG9nICdkb3duIGtleSdcbiAgICAgICAgbmV4dFBhZ2VJbmRleCA9IChzZWxlY3RlZEluZGV4ICsgMSkgJSBzbGlkZUxpc3QubGVuZ3RoXG4gICAgICAgIG5leHRQYWdlSWQgICAgPSBzbGlkZUxpc3RbbmV4dFBhZ2VJbmRleF0uaWRcbiAgICAgICAgY29uc29sZS5sb2cgJ25leHQgaWQgPSAnICsgbmV4dFBhZ2VJZFxuICAgICAgICAkKCcuc2xpZGVfd3JhcHBlcicpLmNzcygnYmFja2dyb3VuZENvbG9yJywgJycpXG4gICAgICAgICQoXCIjI3tuZXh0UGFnZUlkfVwiKS5jc3MoJ2JhY2tncm91bmRDb2xvcicsICcjZmZlM2I0JylcbiAgICAgICAgc2VsZWN0ZWRJbmRleCA9IG5leHRQYWdlSW5kZXhcbiAgICAgICAgI2lwYy5zZW5kVG9Ib3N0ICdnb1RvUGFnZScsIG5leHRQYWdlSWRcbiAgICAgICAgY2hhbmdlU2xpZGUobmV4dFBhZ2VJZClcbiAgICAgICAgJChcImh0bWwsYm9keVwiKS5hbmltYXRlKHtzY3JvbGxUb3A6JChcIiMje25leHRQYWdlSWR9XCIpLm9mZnNldCgpLnRvcH0pO1xuXG4gICAgJCh3aW5kb3cpLnJlc2l6ZSAoZSkgLT4gYXBwbHlTY3JlZW5TaXplKClcbiAgICBhcHBseVNjcmVlblNpemUoKVxuXG5cbiAgICAjIHByZXNlbnRhdGlvbiA9PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAgIGlwYy5vbiAncmVxdWVzdFNsaWRlSW5mbycsICgpID0+XG4gICAgICBjb25zb2xlLmxvZyAncmVjZWl2ZSByZXF1ZXN0U2xpZGVJbmZvJ1xuICAgICAgbWFya2Rvd25Cb2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1hcmtkb3duLWJvZHknKVxuICAgICAjIGNvbnNvbGUubG9nIG1hcmtkb3duQm9keS5pbm5lckhUTUxcbiAgICAgIGlwYy5zZW5kVG9Ib3N0ICdzZW5kU2xpZGVJbmZvJywgbWFya2Rvd25Cb2R5LmlubmVySFRNTFxuICAgICAgY29uc29sZS5sb2cgbWFya2Rvd25Cb2R5LmlubmVySFRNTFxuICAgICAgY29uc29sZS5sb2cgJ3NlbmQgc2VuZFNsaWRlSW5mbydcblxuICAgIGlwYy5zZW5kVG9Ib3N0ICdyZXF1ZXN0U2xpZGVIVE1MJywgKCkgPT5cbiAgICAgIGNvbnNvbGUubG9nICdzZW5kIHJlcXVlc3RTbGlkZUhUTUwnXG5cbiAgICBpcGMub24gJ3NldFNsaWRlJywgKGUsIHRleHQpID0+XG4gICAgICBjb25zb2xlLmxvZyAncmVjZWl2ZSBzZXRTbGlkZSdcbiAgICAgIGNvbnNvbGUubG9nIHRleHRcbiAgICAgIHNsaWRlSFRNTCA9IHRleHQuam9pbihcIlwiKVxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1hcmtkb3duLWJvZHknKS5pbm5lckhUTUwgPSBzbGlkZUhUTUxcbiAgICAgICMgc2xpZGVMaXN0IOOBuHB1c2hcbiAgICAgICQoJy5zbGlkZV93cmFwcGVyJykuZWFjaCAoaWR4LCBlbGVtKSAtPlxuICAgICAgICAjIEhUTUxPYmplY3TjgpJwdXNoXG4gICAgICAgIHNsaWRlTGlzdC5wdXNoIGVsZW1cblxuICAgICMgc2xpZGUgc29ydFxuICAgICQoJy5tYXJrZG93bi1ib2R5Jykuc29ydGFibGUge1xuICAgICAgJ29wYWNpdHknOiAwLjVcbiAgICB9XG4gICAgJCgnLm1hcmtkb3duLWJvZHknKS5kaXNhYmxlU2VsZWN0aW9uKClcbiAgICAkKGRvY3VtZW50KS5vbiAnc29ydHN0b3AnLCAnLm1hcmtkb3duLWJvZHknLCAoKSAtPlxuICAgICAgY29uc29sZS5sb2cgJ3NvcnQgZmluaXNoZWQnXG4gICAgICAjIHNsaWRlTGlzdCB1cGRhdGVcbiAgICAgIHNsaWRlTGlzdCA9IFtdXG4gICAgICAkKCcuc2xpZGVfd3JhcHBlcicpLmVhY2ggKGlkeCwgZWxlbSkgLT5cbiAgICAgICBzbGlkZUxpc3QucHVzaCBlbGVtXG5cblxuXG5cbiJdfQ==
