var MickrClient, Path, clsMarkdown, ipc, resolvePathFromMarp;

clsMarkdown = require('./classes/mds_markdown');

ipc = require('electron').ipcRenderer;

Path = require('path');

MickrClient = require('../modules/MickrClient');

resolvePathFromMarp = function(path) {
  if (path == null) {
    path = './';
  }
  return Path.resolve(__dirname, '../', path);
};

document.addEventListener('DOMContentLoaded', function() {
  var changeSlide, client, selectedIndex, setting, slideHTML, slideList;
  setting = {
    "id": "presenDevSlide",
    "url": "ws://apps.wisdomweb.net:64260/ws/mik",
    "site": "test",
    "token": "Pad:9948"
  };
  client = new MickrClient(setting);
  changeSlide = function(page) {
    return client.send("goToPage", {
      "to": "presenSlide",
      "body": {
        "content": page
      }
    });
  };
  slideHTML = "";
  slideList = [];
  selectedIndex = 0;
  return (function($) {
    var Markdown, applyCurrentPage, applyScreenSize, applySlideSize, getCSSvar, getScreenSize, getSlideSize, render, setImageDirectory, setStyle, themes;
    $("[data-marp-path-resolver]").each(function() {
      var j, len, ref, results, target;
      ref = $(this).attr('data-marp-path-resolver').split(/\s+/);
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        target = ref[j];
        results.push($(this).attr(target, resolvePathFromMarp($(this).attr(target))));
      }
      return results;
    });
    Markdown = new clsMarkdown({
      afterRender: clsMarkdown.generateAfterRender($)
    });
    themes = {};
    themes.current = function() {
      return $('#theme-css').attr('href');
    };
    themes["default"] = themes.current();
    themes.apply = function(path) {
      var toApply;
      if (path == null) {
        path = null;
      }
      toApply = resolvePathFromMarp(path || themes["default"]);
      if (toApply !== themes.current()) {
        $('#theme-css').attr('href', toApply);
        setTimeout(applyScreenSize, 20);
        return toApply.match(/([^\/]+)\.css$/)[1];
      }
      return false;
    };
    setStyle = function(identifier, css) {
      var elm, id;
      id = "mds-" + identifier + "Style";
      elm = $("#" + id);
      if (elm.length <= 0) {
        elm = $("<style id=\"" + id + "\"></style>").appendTo(document.head);
      }
      return elm.text(css);
    };
    getCSSvar = function(prop) {
      return document.defaultView.getComputedStyle(document.body).getPropertyValue(prop);
    };
    getSlideSize = function() {
      var size;
      size = {
        w: +getCSSvar('--slide-width'),
        h: +getCSSvar('--slide-height')
      };
      size.ratio = size.w / size.h;
      return size;
    };
    applySlideSize = function(width, height) {
      setStyle('slideSize', "body {\n  --slide-width: " + (width || 'inherit') + ";\n  --slide-height: " + (height || 'inherit') + ";\n}");
      return applyScreenSize();
    };
    getScreenSize = function() {
      var previewMargin, size;
      size = {
        w: document.documentElement.clientWidth,
        h: document.documentElement.clientHeight
      };
      previewMargin = +getCSSvar('--preview-margin');
      size.ratio = (size.w - previewMargin * 2) / (size.h - previewMargin * 2);
      return size;
    };
    applyScreenSize = function() {
      var size;
      size = getScreenSize();
      setStyle('screenSize', "body { --screen-width: " + size.w + "; --screen-height: " + size.h + "; }");
      return $('#container').toggleClass('height-base', size.ratio > getSlideSize().ratio);
    };
    applyCurrentPage = function(page) {
      return setStyle('currentPage', "@media not print {\n  body.slide-view.screen .slide_wrapper:not(:nth-of-type(" + page + ")) {\n    width: 0 !important;\n    height: 0 !important;\n    border: none !important;\n    box-shadow: none !important;\n  }\n}");
    };
    render = function(md) {
      var i, slideOuterHTML, value;
      console.log('call render');
      applySlideSize(md.settings.getGlobal('width'), md.settings.getGlobal('height'));
      md.changedTheme = themes.apply(md.settings.getGlobal('theme'));
      slideOuterHTML = [];
      for (i in slideList) {
        value = slideList[i];
        slideOuterHTML.push(value.outerHTML);
      }
      $('#markdown').html(slideOuterHTML.join(' '));
      $('.slide_wrapper').css('backgroundColor', '');
      $('#1').css('backgroundColor', '#ffe3b4');
      $('.slide_wrapper').on('click', function() {
        $('.slide_wrapper').css('backgroundColor', '');
        $(this).css('backgroundColor', '#ffe3b4');
        $("html,body").animate({
          scrollTop: $(this).offset().top
        });
        return changeSlide($(this).attr('id'));
      });
      ipc.sendToHost('rendered', md);
      if (md.rulerChanged) {
        ipc.sendToHost('rulerChanged', md.rulers);
      }
      if (md.changedTheme) {
        return ipc.sendToHost('themeChanged', md.changedTheme);
      }
    };
    setImageDirectory = function(dir) {
      return $('head > base').attr('href', dir || './');
    };
    ipc.on('render', function(e, md) {
      return render(Markdown.parse(md));
    });
    ipc.on('currentPage', function(e, page) {
      return applyCurrentPage(page);
    });
    ipc.on('setClass', function(e, classes) {
      return $('body').attr('class', classes);
    });
    ipc.on('setImageDirectory', function(e, dir) {
      return setImageDirectory(dir);
    });
    ipc.on('requestPdfOptions', function(e, opts) {
      return sendPdfOptions(opts || {});
    });
    ipc.on('unfreeze', function() {
      return $('body').removeClass('to-pdf');
    });
    $(document).on('click', 'a', function(e) {
      e.preventDefault();
      return ipc.sendToHost('linkTo', $(e.currentTarget).attr('href'));
    });
    $(document).keydown(function(e) {
      var nextPageId, nextPageIndex;
      if (e.keyCode === 38) {
        console.log('up key');
        nextPageIndex = (selectedIndex + (slideList.length - 1)) % slideList.length;
        nextPageId = slideList[nextPageIndex].id;
        console.log('next id = ' + nextPageId);
        $('.slide_wrapper').css('backgroundColor', '');
        $("#" + nextPageId).css('backgroundColor', '#ffe3b4');
        selectedIndex = nextPageIndex;
        changeSlide(nextPageId);
        $("html,body").animate({
          scrollTop: $("#" + nextPageId).offset().top
        });
      }
      if (e.keyCode === 40) {
        console.log('down key');
        nextPageIndex = (selectedIndex + 1) % slideList.length;
        nextPageId = slideList[nextPageIndex].id;
        console.log('next id = ' + nextPageId);
        $('.slide_wrapper').css('backgroundColor', '');
        $("#" + nextPageId).css('backgroundColor', '#ffe3b4');
        selectedIndex = nextPageIndex;
        changeSlide(nextPageId);
        return $("html,body").animate({
          scrollTop: $("#" + nextPageId).offset().top
        });
      }
    });
    $(window).resize(function(e) {
      return applyScreenSize();
    });
    applyScreenSize();
    ipc.on('requestSlideInfo', (function(_this) {
      return function() {
        var markdownBody;
        console.log('receive requestSlideInfo');
        markdownBody = document.querySelector('.markdown-body');
        ipc.sendToHost('sendSlideInfo', markdownBody.innerHTML);
        console.log(markdownBody.innerHTML);
        return console.log('send sendSlideInfo');
      };
    })(this));
    ipc.sendToHost('requestSlideHTML', (function(_this) {
      return function() {
        return console.log('send requestSlideHTML');
      };
    })(this));
    ipc.on('setSlide', (function(_this) {
      return function(e, text) {
        console.log('receive setSlide');
        console.log(text);
        slideHTML = text.join("");
        document.querySelector('.markdown-body').innerHTML = slideHTML;
        return $('.slide_wrapper').each(function(idx, elem) {
          return slideList.push(elem);
        });
      };
    })(this));
    $('.markdown-body').sortable({});
    $('.markdown-body').disableSelection();
    return $(document).on('sortstop', '.markdown-body', function() {
      console.log('sort finished');
      slideList = [];
      return $('.slide_wrapper').each(function(idx, elem) {
        return slideList.push(elem);
      });
    });
  })($);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJlc2VuRGV2U2xpZGUuanMiLCJzb3VyY2VzIjpbInByZXNlbkRldlNsaWRlLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBOztBQUFBLFdBQUEsR0FBYyxPQUFBLENBQVEsd0JBQVI7O0FBQ2QsR0FBQSxHQUFjLE9BQUEsQ0FBUSxVQUFSLENBQW1CLENBQUM7O0FBQ2xDLElBQUEsR0FBYyxPQUFBLENBQVEsTUFBUjs7QUFDZCxXQUFBLEdBQWMsT0FBQSxDQUFRLHdCQUFSOztBQUVkLG1CQUFBLEdBQXNCLFNBQUMsSUFBRDs7SUFBQyxPQUFPOztTQUFTLElBQUksQ0FBQyxPQUFMLENBQWEsU0FBYixFQUF3QixLQUF4QixFQUErQixJQUEvQjtBQUFqQjs7QUFFdEIsUUFBUSxDQUFDLGdCQUFULENBQTBCLGtCQUExQixFQUE4QyxTQUFBO0FBQzVDLE1BQUE7RUFBQSxPQUFBLEdBQ0M7SUFBQSxJQUFBLEVBQU0sZ0JBQU47SUFDQSxLQUFBLEVBQU8sc0NBRFA7SUFFQSxNQUFBLEVBQVEsTUFGUjtJQUdBLE9BQUEsRUFBUyxVQUhUOztFQUlELE1BQUEsR0FBUyxJQUFJLFdBQUosQ0FBZ0IsT0FBaEI7RUFFVCxXQUFBLEdBQWMsU0FBQyxJQUFEO1dBQ1osTUFBTSxDQUFDLElBQVAsQ0FBWSxVQUFaLEVBQXdCO01BQ3RCLElBQUEsRUFBTSxhQURnQjtNQUV0QixNQUFBLEVBQ0U7UUFBQSxTQUFBLEVBQVcsSUFBWDtPQUhvQjtLQUF4QjtFQURZO0VBU2QsU0FBQSxHQUFZO0VBQ1osU0FBQSxHQUFZO0VBRVosYUFBQSxHQUFnQjtTQUViLENBQUEsU0FBQyxDQUFEO0FBRUQsUUFBQTtJQUFBLENBQUEsQ0FBRSwyQkFBRixDQUE4QixDQUFDLElBQS9CLENBQW9DLFNBQUE7QUFDbEMsVUFBQTtBQUFBO0FBQUE7V0FBQSxxQ0FBQTs7cUJBQ0UsQ0FBQSxDQUFFLElBQUYsQ0FBSSxDQUFDLElBQUwsQ0FBVSxNQUFWLEVBQWtCLG1CQUFBLENBQW9CLENB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QUEzQixFQUE2QyxTQUFBO01BQzNDLE9BQU8sQ0FBQyxHQUFSLENBQVksZUFBWjtNQUVBLFNBQUEsR0FBWTthQUNaLENBQUEsQ0FBRSxnQkFBRixDQUFtQixDQUFDLElBQXBCLENBQXlCLFNBQUMsR0FBRCxFQUFNLElBQU47ZUFDeEIsU0FBUyxDQUFDLElBQVYsQ0FBZSxJQUFmO01BRHdCLENBQXpCO0lBSjJDLENBQTdDO0VBbkxDLENBQUEsQ0FBSCxDQUFJLENBQUo7QUF0QjRDLENBQTlDIiwic291cmNlc0NvbnRlbnQiOlsiY2xzTWFya2Rvd24gPSByZXF1aXJlICcuL2NsYXNzZXMvbWRzX21hcmtkb3duJ1xuaXBjICAgICAgICAgPSByZXF1aXJlKCdlbGVjdHJvbicpLmlwY1JlbmRlcmVyXG5QYXRoICAgICAgICA9IHJlcXVpcmUgJ3BhdGgnXG5NaWNrckNsaWVudCA9IHJlcXVpcmUgJy4uL21vZHVsZXMvTWlja3JDbGllbnQnXG5cbnJlc29sdmVQYXRoRnJvbU1hcnAgPSAocGF0aCA9ICcuLycpIC0+IFBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLi8nLCBwYXRoKVxuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyICdET01Db250ZW50TG9hZGVkJywgLT5cbiAgc2V0dGluZyA9XG4gICBcImlkXCI6IFwicHJlc2VuRGV2U2xpZGVcIlxuICAgXCJ1cmxcIjogXCJ3czovL2FwcHMud2lzZG9td2ViLm5ldDo2NDI2MC93cy9taWtcIlxuICAgXCJzaXRlXCI6IFwidGVzdFwiXG4gICBcInRva2VuXCI6IFwiUGFkOjk5NDhcIlxuICBjbGllbnQgPSBuZXcgTWlja3JDbGllbnQoc2V0dGluZyk7XG5cbiAgY2hhbmdlU2xpZGUgPSAocGFnZSkgLT5cbiAgICBjbGllbnQuc2VuZCBcImdvVG9QYWdlXCIsIHtcbiAgICAgIFwidG9cIjogXCJwcmVzZW5TbGlkZVwiLFxuICAgICAgXCJib2R5XCI6XG4gICAgICAgIFwiY29udGVudFwiOiBwYWdlXG4gICAgfVxuXG5cblxuICBzbGlkZUhUTUwgPSBcIlwiXG4gIHNsaWRlTGlzdCA9IFtdXG4gICMgc2xpZGVMaXN044Gu5L2V55Wq55uu44Gu6KaB57Sg44GM54++5Zyo6YG45oqe44GV44KM44Gm44GE44KL44GLXG4gIHNlbGVjdGVkSW5kZXggPSAwXG5cbiAgZG8gKCQpIC0+XG4gICAgIyBGaXJzdCwgcmVzb2x2ZSBNYXJwIHJlc291cmNlcyBwYXRoXG4gICAgJChcIltkYXRhLW1hcnAtcGF0aC1yZXNvbHZlcl1cIikuZWFjaCAtPlxuICAgICAgZm9yIHRhcmdldCBpbiAkKEApLmF0dHIoJ2RhdGEtbWFycC1wYXRoLXJlc29sdmVyJykuc3BsaXQoL1xccysvKVxuICAgICAgICAkKEApLmF0dHIodGFyZ2V0LCByZXNvbHZlUGF0aEZyb21NYXJwKCQoQCkuYXR0cih0YXJnZXQpKSlcblxuICAgIE1hcmtkb3duID0gbmV3IGNsc01hcmtkb3duKHsgYWZ0ZXJSZW5kZXI6IGNsc01hcmtkb3duLmdlbmVyYXRlQWZ0ZXJSZW5kZXIoJCkgfSlcblxuICAgIHRoZW1lcyA9IHt9XG4gICAgdGhlbWVzLmN1cnJlbnQgPSAtPiAkKCcjdGhlbWUtY3NzJykuYXR0cignaHJlZicpXG4gICAgdGhlbWVzLmRlZmF1bHQgPSB0aGVtZXMuY3VycmVudCgpXG4gICAgdGhlbWVzLmFwcGx5ID0gKHBhdGggPSBudWxsKSAtPlxuICAgICAgdG9BcHBseSA9IHJlc29sdmVQYXRoRnJvbU1hcnAocGF0aCB8fCB0aGVtZXMuZGVmYXVsdClcblxuICAgICAgaWYgdG9BcHBseSBpc250IHRoZW1lcy5jdXJyZW50KClcbiAgICAgICAgJCgnI3RoZW1lLWNzcycpLmF0dHIoJ2hyZWYnLCB0b0FwcGx5KVxuICAgICAgICBzZXRUaW1lb3V0IGFwcGx5U2NyZWVuU2l6ZSwgMjBcblxuICAgICAgICByZXR1cm4gdG9BcHBseS5tYXRjaCgvKFteXFwvXSspXFwuY3NzJC8pWzFdXG4gICAgICBmYWxzZVxuXG4gICAgc2V0U3R5bGUgPSAoaWRlbnRpZmllciwgY3NzKSAtPlxuICAgICAgaWQgID0gXCJtZHMtI3tpZGVudGlmaWVyfVN0eWxlXCJcbiAgICAgIGVsbSA9ICQoXCIjI3tpZH1cIilcbiAgICAgIGVsbSA9ICQoXCI8c3R5bGUgaWQ9XFxcIiN7aWR9XFxcIj48L3N0eWxlPlwiKS5hcHBlbmRUbyhkb2N1bWVudC5oZWFkKSBpZiBlbG0ubGVuZ3RoIDw9IDBcbiAgICAgIGVsbS50ZXh0KGNzcylcblxuICAgIGdldENTU3ZhciA9IChwcm9wKSAtPiBkb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKGRvY3VtZW50LmJvZHkpLmdldFByb3BlcnR5VmFsdWUocHJvcClcblxuICAgIGdldFNsaWRlU2l6ZSA9IC0+XG4gICAgICBzaXplID1cbiAgICAgICAgdzogK2dldENTU3ZhciAnLS1zbGlkZS13aWR0aCdcbiAgICAgICAgaDogK2dldENTU3ZhciAnLS1zbGlkZS1oZWlnaHQnXG5cbiAgICAgIHNpemUucmF0aW8gPSBzaXplLncgLyBzaXplLmhcbiAgICAgIHNpemVcblxuICAgIGFwcGx5U2xpZGVTaXplID0gKHdpZHRoLCBoZWlnaHQpIC0+XG4gICAgICBzZXRTdHlsZSAnc2xpZGVTaXplJyxcbiAgICAgICAgXCJcIlwiXG4gICAgICAgIGJvZHkge1xuICAgICAgICAgIC0tc2xpZGUtd2lkdGg6ICN7d2lkdGggfHwgJ2luaGVyaXQnfTtcbiAgICAgICAgICAtLXNsaWRlLWhlaWdodDogI3toZWlnaHQgfHwgJ2luaGVyaXQnfTtcbiAgICAgICAgfVxuICAgICAgICBcIlwiXCJcbiAgICAgIGFwcGx5U2NyZWVuU2l6ZSgpXG5cbiAgICBnZXRTY3JlZW5TaXplID0gLT5cbiAgICAgIHNpemUgPVxuICAgICAgICB3OiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGhcbiAgICAgICAgaDogZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodFxuXG4gICAgICBwcmV2aWV3TWFyZ2luID0gK2dldENTU3ZhciAnLS1wcmV2aWV3LW1hcmdpbidcbiAgICAgIHNpemUucmF0aW8gPSAoc2l6ZS53IC0gcHJldmlld01hcmdpbiAqIDIpIC8gKHNpemUuaCAtIHByZXZpZXdNYXJnaW4gKiAyKVxuICAgICAgc2l6ZVxuXG4gICAgYXBwbHlTY3JlZW5TaXplID0gLT5cbiAgICAgIHNpemUgPSBnZXRTY3JlZW5TaXplKClcbiAgICAgIHNldFN0eWxlICdzY3JlZW5TaXplJywgXCJib2R5IHsgLS1zY3JlZW4td2lkdGg6ICN7c2l6ZS53fTsgLS1zY3JlZW4taGVpZ2h0OiAje3NpemUuaH07IH1cIlxuICAgICAgJCgnI2NvbnRhaW5lcicpLnRvZ2dsZUNsYXNzICdoZWlnaHQtYmFzZScsIHNpemUucmF0aW8gPiBnZXRTbGlkZVNpemUoKS5yYXRpb1xuXG4gICAgIyDjg5rjg7zjgrjnlarlj7fjgpLlj5fjgZHlj5bjgaPjgZ/jgYLjgajjgIHnj77lnKjjga7jg5rjg7zjgrjku6XlpJbjga7jg5rjg7zjgrjjga7jgrnjg6njgqTjg4njgpLpnZ7ooajnpLrjgavjgZnjgotcbiAgICAjIOOBn+OBoOOBl+OAgemdnuODl+ODquODs+ODiOeKtuaFi+OBruaZgumZkOWumlxuICAgIGFwcGx5Q3VycmVudFBhZ2UgPSAocGFnZSkgLT5cbiAgICAgIHNldFN0eWxlICdjdXJyZW50UGFnZScsXG4gICAgICAgIFwiXCJcIlxuICAgICAgICBAbWVkaWEgbm90IHByaW50IHtcbiAgICAgICAgICBib2R5LnNsaWRlLXZpZXcuc2NyZWVuIC5zbGlkZV93cmFwcGVyOm5vdCg6bnRoLW9mLXR5cGUoI3twYWdlfSkpIHtcbiAgICAgICAgICAgIHdpZHRoOiAwICFpbXBvcnRhbnQ7XG4gICAgICAgICAgICBoZWlnaHQ6IDAgIWltcG9ydGFudDtcbiAgICAgICAgICAgIGJvcmRlcjogbm9uZSAhaW1wb3J0YW50O1xuICAgICAgICAgICAgYm94LXNoYWRvdzogbm9uZSAhaW1wb3J0YW50O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcIlwiXCJcbiAgICAjIHByZXNlbkRldueUu+mdouOBp+OBr+OBr+OBmOOCgeOBq+S4gOWbnuOBoOOBkeWRvOOBsOOCjOOCi1xuICAgIHJlbmRlciA9IChtZCkgLT5cbiAgICAgIGNvbnNvbGUubG9nICdjYWxsIHJlbmRlcidcbiAgICAgIGFwcGx5U2xpZGVTaXplIG1kLnNldHRpbmdzLmdldEdsb2JhbCgnd2lkdGgnKSwgbWQuc2V0dGluZ3MuZ2V0R2xvYmFsKCdoZWlnaHQnKVxuICAgICAgbWQuY2hhbmdlZFRoZW1lID0gdGhlbWVzLmFwcGx5IG1kLnNldHRpbmdzLmdldEdsb2JhbCgndGhlbWUnKVxuICAgICAgIyAkKCcjbWFya2Rvd24nKS5odG1sKHNsaWRlSFRNTClcblxuICAgICAgIyBzbGlkZUxpc3TopoHntKDjgZ3jgozjgZ7jgozjgYvjgolvdXRlckhUTUzjgpLlj5bjgorlh7rjgZfjg6rjgrnjg4jjgavmoLzntI1cbiAgICAgIHNsaWRlT3V0ZXJIVE1MID0gW11cbiAgICAgIGZvciBpLCB2YWx1ZSBvZiBzbGlkZUxpc3RcbiAgICAgICAgc2xpZGVPdXRlckhUTUwucHVzaCB2YWx1ZS5vdXRlckhUTUxcblxuICAgICAgJCgnI21hcmtkb3duJykuaHRtbChzbGlkZU91dGVySFRNTC5qb2luKCcgJykpXG5cbiAgICAgICMg44Gv44GY44KB44Gu44K544Op44Kk44OJ44Gu6Imy44KS5aSJ44GI44Gm44GK44GN44CB44Gd44Gu44Oa44O844K444GM6YG45oqe44GV44KM44Gm44GE44KL44GT44Go44KS56S644GZXG4gICAgICAkKCcuc2xpZGVfd3JhcHBlcicpLmNzcygnYmFja2dyb3VuZENvbG9yJywgJycpXG4gICAgICAkKCcjMScpLmNzcygnYmFja2dyb3VuZENvbG9yJywgJyNmZmUzYjQnKVxuXG4gICAgICAjIOaKvOOBleOCjOOBn3NsaWRlX3dyYXBwZXLjga5pZOOCkumAgeS/oeOBl+OBpuODmuODvOOCuOmBt+enu1xuICAgICAgJCgnLnNsaWRlX3dyYXBwZXInKS5vbiAnY2xpY2snLCAoKSAtPlxuICAgICAgICAjIOmBuOaKnuOBleOCjOOBn+OCueODqeOCpOODieOBruiJsuOCkuWkieabtOOBl+OAgeOAgOODmuODvOOCuOmBt+enu+OBleOBm+OCi1xuICAgICAgICAkKCcuc2xpZGVfd3JhcHBlcicpLmNzcygnYmFja2dyb3VuZENvbG9yJywgJycpXG4gICAgICAgICQodGhpcykuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCAnI2ZmZTNiNCcpXG4gICAgICAgICQoXCJodG1sLGJvZHlcIikuYW5pbWF0ZSh7c2Nyb2xsVG9wOiQodGhpcykub2Zmc2V0KCkudG9wfSk7XG4gICAgICAgICMg44Oa44O844K456e75YuV44Oh44OD44K744O844K46YCB5L+hXG4gICAgICAgICNpcGMuc2VuZFRvSG9zdCAnZ29Ub1BhZ2UnLCAkKHRoaXMpLmF0dHIoJ2lkJylcbiAgICAgICAgY2hhbmdlU2xpZGUoJCh0aGlzKS5hdHRyKCdpZCcpKVxuXG4gICAgICBpcGMuc2VuZFRvSG9zdCAncmVuZGVyZWQnLCBtZFxuICAgICAgaXBjLnNlbmRUb0hvc3QgJ3J1bGVyQ2hhbmdlZCcsIG1kLnJ1bGVycyBpZiBtZC5ydWxlckNoYW5nZWRcbiAgICAgIGlwYy5zZW5kVG9Ib3N0ICd0aGVtZUNoYW5nZWQnLCBtZC5jaGFuZ2VkVGhlbWUgaWYgbWQuY2hhbmdlZFRoZW1lXG4gICAgc2V0SW1hZ2VEaXJlY3RvcnkgPSAoZGlyKSAtPiAkKCdoZWFkID4gYmFzZScpLmF0dHIoJ2hyZWYnLCBkaXIgfHwgJy4vJylcblxuICAgIGlwYy5vbiAncmVuZGVyJywgKGUsIG1kKSAtPiByZW5kZXIoTWFya2Rvd24ucGFyc2UobWQpKVxuICAgIGlwYy5vbiAnY3VycmVudFBhZ2UnLCAoZSwgcGFnZSkgLT4gYXBwbHlDdXJyZW50UGFnZSBwYWdlXG4gICAgaXBjLm9uICdzZXRDbGFzcycsIChlLCBjbGFzc2VzKSAtPiAkKCdib2R5JykuYXR0ciAnY2xhc3MnLCBjbGFzc2VzXG4gICAgaXBjLm9uICdzZXRJbWFnZURpcmVjdG9yeScsIChlLCBkaXIpIC0+IHNldEltYWdlRGlyZWN0b3J5KGRpcilcbiAgICBpcGMub24gJ3JlcXVlc3RQZGZPcHRpb25zJywgKGUsIG9wdHMpIC0+IHNlbmRQZGZPcHRpb25zKG9wdHMgfHwge30pXG4gICAgaXBjLm9uICd1bmZyZWV6ZScsIC0+ICQoJ2JvZHknKS5yZW1vdmVDbGFzcygndG8tcGRmJylcblxuXG5cbiAgICAjIEluaXRpYWxpemVcbiAgICAkKGRvY3VtZW50KS5vbiAnY2xpY2snLCAnYScsIChlKSAtPlxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICBpcGMuc2VuZFRvSG9zdCAnbGlua1RvJywgJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoJ2hyZWYnKVxuXG4gICAgJChkb2N1bWVudCkua2V5ZG93biAoZSkgLT5cbiAgICAgIGlmIGUua2V5Q29kZSA9PSAzOFxuICAgICAgICBjb25zb2xlLmxvZyAndXAga2V5J1xuICAgICAgICBuZXh0UGFnZUluZGV4ID0gKHNlbGVjdGVkSW5kZXggKyAoc2xpZGVMaXN0Lmxlbmd0aC0xKSkgJSBzbGlkZUxpc3QubGVuZ3RoXG4gICAgICAgIG5leHRQYWdlSWQgICAgPSBzbGlkZUxpc3RbbmV4dFBhZ2VJbmRleF0uaWRcbiAgICAgICAgY29uc29sZS5sb2cgJ25leHQgaWQgPSAnICsgbmV4dFBhZ2VJZFxuICAgICAgICAkKCcuc2xpZGVfd3JhcHBlcicpLmNzcygnYmFja2dyb3VuZENvbG9yJywgJycpXG4gICAgICAgICQoXCIjI3tuZXh0UGFnZUlkfVwiKS5jc3MoJ2JhY2tncm91bmRDb2xvcicsICcjZmZlM2I0JylcbiAgICAgICAgc2VsZWN0ZWRJbmRleCA9IG5leHRQYWdlSW5kZXhcbiAgICAgICAgI2lwYy5zZW5kVG9Ib3N0ICdnb1RvUGFnZScsIG5leHRQYWdlSWRcbiAgICAgICAgY2hhbmdlU2xpZGUobmV4dFBhZ2VJZClcbiAgICAgICAgJChcImh0bWwsYm9keVwiKS5hbmltYXRlKHtzY3JvbGxUb3A6JChcIiMje25leHRQYWdlSWR9XCIpLm9mZnNldCgpLnRvcH0pO1xuXG4gICAgICBpZiBlLmtleUNvZGUgPT0gNDBcbiAgICAgICAgY29uc29sZS5sb2cgJ2Rvd24ga2V5J1xuICAgICAgICBuZXh0UGFnZUluZGV4ID0gKHNlbGVjdGVkSW5kZXggKyAxKSAlIHNsaWRlTGlzdC5sZW5ndGhcbiAgICAgICAgbmV4dFBhZ2VJZCAgICA9IHNsaWRlTGlzdFtuZXh0UGFnZUluZGV4XS5pZFxuICAgICAgICBjb25zb2xlLmxvZyAnbmV4dCBpZCA9ICcgKyBuZXh0UGFnZUlkXG4gICAgICAgICQoJy5zbGlkZV93cmFwcGVyJykuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCAnJylcbiAgICAgICAgJChcIiMje25leHRQYWdlSWR9XCIpLmNzcygnYmFja2dyb3VuZENvbG9yJywgJyNmZmUzYjQnKVxuICAgICAgICBzZWxlY3RlZEluZGV4ID0gbmV4dFBhZ2VJbmRleFxuICAgICAgICAjaXBjLnNlbmRUb0hvc3QgJ2dvVG9QYWdlJywgbmV4dFBhZ2VJZFxuICAgICAgICBjaGFuZ2VTbGlkZShuZXh0UGFnZUlkKVxuICAgICAgICAkKFwiaHRtbCxib2R5XCIpLmFuaW1hdGUoe3Njcm9sbFRvcDokKFwiIyN7bmV4dFBhZ2VJZH1cIikub2Zmc2V0KCkudG9wfSk7XG5cbiAgICAkKHdpbmRvdykucmVzaXplIChlKSAtPiBhcHBseVNjcmVlblNpemUoKVxuICAgIGFwcGx5U2NyZWVuU2l6ZSgpXG5cblxuICAgICMgcHJlc2VudGF0aW9uID09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gICAgaXBjLm9uICdyZXF1ZXN0U2xpZGVJbmZvJywgKCkgPT5cbiAgICAgIGNvbnNvbGUubG9nICdyZWNlaXZlIHJlcXVlc3RTbGlkZUluZm8nXG4gICAgICBtYXJrZG93bkJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWFya2Rvd24tYm9keScpXG4gICAgICMgY29uc29sZS5sb2cgbWFya2Rvd25Cb2R5LmlubmVySFRNTFxuICAgICAgaXBjLnNlbmRUb0hvc3QgJ3NlbmRTbGlkZUluZm8nLCBtYXJrZG93bkJvZHkuaW5uZXJIVE1MXG4gICAgICBjb25zb2xlLmxvZyBtYXJrZG93bkJvZHkuaW5uZXJIVE1MXG4gICAgICBjb25zb2xlLmxvZyAnc2VuZCBzZW5kU2xpZGVJbmZvJ1xuXG4gICAgaXBjLnNlbmRUb0hvc3QgJ3JlcXVlc3RTbGlkZUhUTUwnLCAoKSA9PlxuICAgICAgY29uc29sZS5sb2cgJ3NlbmQgcmVxdWVzdFNsaWRlSFRNTCdcblxuICAgIGlwYy5vbiAnc2V0U2xpZGUnLCAoZSwgdGV4dCkgPT5cbiAgICAgIGNvbnNvbGUubG9nICdyZWNlaXZlIHNldFNsaWRlJ1xuICAgICAgY29uc29sZS5sb2cgdGV4dFxuICAgICAgc2xpZGVIVE1MID0gdGV4dC5qb2luKFwiXCIpXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWFya2Rvd24tYm9keScpLmlubmVySFRNTCA9IHNsaWRlSFRNTFxuICAgICAgIyBzbGlkZUxpc3Qg44G4cHVzaFxuICAgICAgJCgnLnNsaWRlX3dyYXBwZXInKS5lYWNoIChpZHgsIGVsZW0pIC0+XG4gICAgICAgICMgSFRNTE9iamVjdOOCknB1c2hcbiAgICAgICAgc2xpZGVMaXN0LnB1c2ggZWxlbVxuXG4gICAgIyBzbGlkZSBzb3J0XG4gICAgJCgnLm1hcmtkb3duLWJvZHknKS5zb3J0YWJsZSB7XG5cbiAgICB9XG4gICAgJCgnLm1hcmtkb3duLWJvZHknKS5kaXNhYmxlU2VsZWN0aW9uKClcbiAgICAkKGRvY3VtZW50KS5vbiAnc29ydHN0b3AnLCAnLm1hcmtkb3duLWJvZHknLCAoKSAtPlxuICAgICAgY29uc29sZS5sb2cgJ3NvcnQgZmluaXNoZWQnXG4gICAgICAjIHNsaWRlTGlzdCB1cGRhdGVcbiAgICAgIHNsaWRlTGlzdCA9IFtdXG4gICAgICAkKCcuc2xpZGVfd3JhcHBlcicpLmVhY2ggKGlkeCwgZWxlbSkgLT5cbiAgICAgICBzbGlkZUxpc3QucHVzaCBlbGVtXG5cblxuXG5cbiJdfQ==
