var MickrClient, Path, clsMarkdown, ipc, resolvePathFromMarp;

clsMarkdown = require('./classes/mds_markdown');

ipc = require('electron').ipcRenderer;

Path = require('path');

MickrClient = require('../modules/MickrClient');

resolvePathFromMarp = function(path) {
  if (path == null) {
    path = './';
  }
  return Path.resolve(__dirname, '../', path);
};

document.addEventListener('DOMContentLoaded', function() {
  var $, client, setting;
  console.log("" + __dirname);
  $ = window.jQuery = window.$ = require('jquery');
  setting = {
    "id": "slide",
    "url": "ws://apps.wisdomweb.net:64260/ws/mik"
  };
  ({
    "site": "test",
    "token": "Pad:9948"
  });
  console.log("setting = " + setting);
  console.log("setting.url = " + setting.url);
  client = new MickrClient(setting);
  console.log(client);
  return (function($) {
    var Markdown, applyCurrentPage, applyScreenSize, applySlideSize, getCSSvar, getScreenSize, getSlideSize, render, sendPdfOptions, setImageDirectory, setStyle, themes;
    $("[data-marp-path-resolver]").each(function() {
      var i, len, ref, results, target;
      ref = $(this).attr('data-marp-path-resolver').split(/\s+/);
      results = [];
      for (i = 0, len = ref.length; i < len; i++) {
        target = ref[i];
        results.push($(this).attr(target, resolvePathFromMarp($(this).attr(target))));
      }
      return results;
    });
    Markdown = new clsMarkdown({
      afterRender: clsMarkdown.generateAfterRender($)
    });
    themes = {};
    themes.current = function() {
      return $('#theme-css').attr('href');
    };
    themes["default"] = themes.current();
    themes.apply = function(path) {
      var toApply;
      if (path == null) {
        path = null;
      }
      toApply = resolvePathFromMarp(path || themes["default"]);
      if (toApply !== themes.current()) {
        $('#theme-css').attr('href', toApply);
        setTimeout(applyScreenSize, 20);
        return toApply.match(/([^\/]+)\.css$/)[1];
      }
      return false;
    };
    setStyle = function(identifier, css) {
      var elm, id;
      id = "mds-" + identifier + "Style";
      elm = $("#" + id);
      if (elm.length <= 0) {
        elm = $("<style id=\"" + id + "\"></style>").appendTo(document.head);
      }
      return elm.text(css);
    };
    getCSSvar = function(prop) {
      return document.defaultView.getComputedStyle(document.body).getPropertyValue(prop);
    };
    getSlideSize = function() {
      var size;
      size = {
        w: +getCSSvar('--slide-width'),
        h: +getCSSvar('--slide-height')
      };
      size.ratio = size.w / size.h;
      return size;
    };
    applySlideSize = function(width, height) {
      setStyle('slideSize', "body {\n  --slide-width: " + (width || 'inherit') + ";\n  --slide-height: " + (height || 'inherit') + ";\n}");
      return applyScreenSize();
    };
    getScreenSize = function() {
      var previewMargin, size;
      size = {
        w: document.documentElement.clientWidth,
        h: document.documentElement.clientHeight
      };
      previewMargin = +getCSSvar('--preview-margin');
      size.ratio = (size.w - previewMargin * 2) / (size.h - previewMargin * 2);
      return size;
    };
    applyScreenSize = function() {
      var size;
      size = getScreenSize();
      setStyle('screenSize', "body { --screen-width: " + size.w + "; --screen-height: " + size.h + "; }");
      return $('#container').toggleClass('height-base', size.ratio > getSlideSize().ratio);
    };
    applyCurrentPage = function(page) {
      return setStyle('currentPage', "@media not print {\n  body.slide-view.screen .slide_wrapper:not(:nth-of-type(" + page + ")) {\n    width: 0 !important;\n    height: 0 !important;\n    border: none !important;\n    box-shadow: none !important;\n  }\n}");
    };
    render = function(md) {
      applySlideSize(md.settings.getGlobal('width'), md.settings.getGlobal('height'));
      md.changedTheme = themes.apply(md.settings.getGlobal('theme'));
      $('#markdown').html(md.parsed);
      ipc.sendToHost('rendered', md);
      if (md.rulerChanged) {
        ipc.sendToHost('rulerChanged', md.rulers);
      }
      if (md.changedTheme) {
        return ipc.sendToHost('themeChanged', md.changedTheme);
      }
    };
    sendPdfOptions = function(opts) {
      var slideSize;
      slideSize = getSlideSize();
      opts.exportSize = {
        width: Math.floor(slideSize.w * 25400 / 96),
        height: Math.floor(slideSize.h * 25400 / 96)
      };
      $('body').addClass('to-pdf');
      return setTimeout((function() {
        return ipc.sendToHost('responsePdfOptions', opts);
      }), 0);
    };
    setImageDirectory = function(dir) {
      return $('head > base').attr('href', dir || './');
    };
    ipc.on('render', function(e, md) {
      return render(Markdown.parse(md));
    });
    ipc.on('currentPage', function(e, page) {
      return applyCurrentPage(page);
    });
    ipc.on('setClass', function(e, classes) {
      return $('body').attr('class', classes);
    });
    ipc.on('setImageDirectory', function(e, dir) {
      return setImageDirectory(dir);
    });
    ipc.on('requestPdfOptions', function(e, opts) {
      return sendPdfOptions(opts || {});
    });
    ipc.on('unfreeze', function() {
      return $('body').removeClass('to-pdf');
    });
    $(document).on('click', 'a', function(e) {
      e.preventDefault();
      return ipc.sendToHost('linkTo', $(e.currentTarget).attr('href'));
    });
    $(window).resize(function(e) {
      return applyScreenSize();
    });
    applyScreenSize();
    ipc.on('requestSlideInfo', (function(_this) {
      return function() {
        var markdownBody;
        console.log('receive requestSlideInfo');
        markdownBody = [];
        $('.slide_wrapper').each(function(idx, elem) {
          return markdownBody.push(elem.outerHTML);
        });
        console.log(markdownBody);
        ipc.sendToHost('sendSlideInfo', markdownBody);
        return console.log('send sendSlideInfo');
      };
    })(this));
    ipc.sendToHost('requestSlideHTML', (function(_this) {
      return function() {
        return console.log('send requestSlideHTML');
      };
    })(this));
    ipc.on('setSlide', (function(_this) {
      return function(e, text) {
        console.log('receive setSlide');
        console.log(text);
        return console.log($('.markdown-body').html(text));
      };
    })(this));
    return ipc.on('goToPage', (function(_this) {
      return function(e, page) {
        console.log(page);
        return applyCurrentPage(page);
      };
    })(this));
  })($);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2xpZGUuanMiLCJzb3VyY2VzIjpbInNsaWRlLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBOztBQUFBLFdBQUEsR0FBYyxPQUFBLENBQVEsd0JBQVI7O0FBQ2QsR0FBQSxHQUFjLE9BQUEsQ0FBUSxVQUFSLENBQW1CLENBQUM7O0FBQ2xDLElBQUEsR0FBYyxPQUFBLENBQVEsTUFBUjs7QUFDZCxXQUFBLEdBQWMsT0FBQSxDQUFRLHdCQUFSOztBQUdkLG1CQUFBLEdBQXNCLFNBQUMsSUFBRDs7SUFBQyxPQUFPOztTQUFTLElBQUksQ0FBQyxPQUFMLENBQWEsU0FBYixFQUF3QixLQUF4QixFQUErQixJQUEvQjtBQUFqQjs7QUFDdEIsUUFBUSxDQUFDLGdCQUFULENBQTBCLGtCQUExQixFQUE4QyxTQUFBO0FBQzVDLE1BQUE7RUFBQSxPQUFPLENBQUMsR0FBUixDQUFZLEVBQUEsR0FBRyxTQUFmO0VBQ0EsQ0FBQSxHQUFJLE1BQU0sQ0FBQyxNQUFQLEdBQWdCLE1BQU0sQ0FBQyxDQUFQLEdBQVcsT0FBQSxDQUFRLFFBQVI7RUFDL0IsT0FBQSxHQUNHO0lBQUEsSUFBQSxFQUFNLE9BQU47SUFDQSxLQUFBLEVBQU8sc0NBRFA7O0VBRUQsQ0FBQTtJQUFBLE1BQUEsRUFBUSxNQUFSO0lBQ0EsT0FBQSxFQUFTLFVBRFQ7R0FBQTtFQUdGLE9BQU8sQ0FBQyxHQUFSLENBQVksWUFBQSxHQUFlLE9BQTNCO0VBQ0EsT0FBTyxDQUFDLEdBQVIsQ0FBWSxnQkFBQSxHQUFtQixPQUFPLENBQUMsR0FBdkM7RUFDQSxNQUFBLEdBQVMsSUFBSSxXQUFKLENBQWdCLE9BQWhCO0VBQ1QsT0FBTyxDQUFDLEdBQVIsQ0FBWSxNQUFaO1NBR0csQ0FBQSxTQUFDLENBQUQ7QUFJRCxRQUFBO0lBQUEsQ0FBQSxDQUFFLDJCQUFGLENBQThCLENBQUMsSUFBL0IsQ0FBb0MsU0FBQTtBQUNsQyxVQUFBO0FBQUE7QUFBQTtXQUFBLHFDQUFBOztxQkFDRSxDQUFBLENBQUUs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LENBQUEsQ0FBQSxJQUFBLENBQW5DO0lBR0EsR0FBRyxDQUFDLEVBQUosQ0FBTyxVQUFQLEVBQW1CLENBQUEsU0FBQSxLQUFBO2FBQUEsU0FBQyxDQUFELEVBQUksSUFBSjtRQUNqQixPQUFPLENBQUMsR0FBUixDQUFZLGtCQUFaO1FBQ0EsT0FBTyxDQUFDLEdBQVIsQ0FBWSxJQUFaO2VBQ0EsT0FBTyxDQUFDLEdBQVIsQ0FBWSxDQUFBLENBQUUsZ0JBQUYsQ0FBbUIsQ0FBQyxJQUFwQixDQUF5QixJQUF6QixDQUFaO01BSGlCO0lBQUEsQ0FBQSxDQUFBLENBQUEsSUFBQSxDQUFuQjtXQUtBLEdBQUcsQ0FBQyxFQUFKLENBQU8sVUFBUCxFQUFtQixDQUFBLFNBQUEsS0FBQTthQUFBLFNBQUMsQ0FBRCxFQUFJLElBQUo7UUFDakIsT0FBTyxDQUFDLEdBQVIsQ0FBWSxJQUFaO2VBQ0EsZ0JBQUEsQ0FBaUIsSUFBakI7TUFGaUI7SUFBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLENBQW5CO0VBOUpDLENBQUEsQ0FBSCxDQUFJLENBQUo7QUFmNEMsQ0FBOUMiLCJzb3VyY2VzQ29udGVudCI6WyJjbHNNYXJrZG93biA9IHJlcXVpcmUgJy4vY2xhc3Nlcy9tZHNfbWFya2Rvd24nXG5pcGMgICAgICAgICA9IHJlcXVpcmUoJ2VsZWN0cm9uJykuaXBjUmVuZGVyZXJcblBhdGggICAgICAgID0gcmVxdWlyZSAncGF0aCdcbk1pY2tyQ2xpZW50ID0gcmVxdWlyZSAnLi4vbW9kdWxlcy9NaWNrckNsaWVudCdcblxuXG5yZXNvbHZlUGF0aEZyb21NYXJwID0gKHBhdGggPSAnLi8nKSAtPiBQYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4vJywgcGF0aClcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgJ0RPTUNvbnRlbnRMb2FkZWQnLCAtPlxuICBjb25zb2xlLmxvZyBcIiN7X19kaXJuYW1lfVwiXG4gICQgPSB3aW5kb3cualF1ZXJ5ID0gd2luZG93LiQgPSByZXF1aXJlKCdqcXVlcnknKVxuICBzZXR0aW5nID1cbiAgICAgXCJpZFwiOiBcInNsaWRlXCJcbiAgICAgXCJ1cmxcIjogXCJ3czovL2FwcHMud2lzZG9td2ViLm5ldDo2NDI2MC93cy9taWtcIlxuICAgIFwic2l0ZVwiOiBcInRlc3RcIlxuICAgIFwidG9rZW5cIjogXCJQYWQ6OTk0OFwiXG5cbiAgY29uc29sZS5sb2cgXCJzZXR0aW5nID0gXCIgKyBzZXR0aW5nXG4gIGNvbnNvbGUubG9nIFwic2V0dGluZy51cmwgPSBcIiArIHNldHRpbmcudXJsXG4gIGNsaWVudCA9IG5ldyBNaWNrckNsaWVudChzZXR0aW5nKTtcbiAgY29uc29sZS5sb2cgY2xpZW50XG5cblxuICBkbyAoJCkgLT5cblxuXG4gICAgIyBGaXJzdCwgcmVzb2x2ZSBNYXJwIHJlc291cmNlcyBwYXRoXG4gICAgJChcIltkYXRhLW1hcnAtcGF0aC1yZXNvbHZlcl1cIikuZWFjaCAtPlxuICAgICAgZm9yIHRhcmdldCBpbiAkKEApLmF0dHIoJ2RhdGEtbWFycC1wYXRoLXJlc29sdmVyJykuc3BsaXQoL1xccysvKVxuICAgICAgICAkKEApLmF0dHIodGFyZ2V0LCByZXNvbHZlUGF0aEZyb21NYXJwKCQoQCkuYXR0cih0YXJnZXQpKSlcblxuICAgIE1hcmtkb3duID0gbmV3IGNsc01hcmtkb3duKHsgYWZ0ZXJSZW5kZXI6IGNsc01hcmtkb3duLmdlbmVyYXRlQWZ0ZXJSZW5kZXIoJCkgfSlcblxuICAgIHRoZW1lcyA9IHt9XG4gICAgdGhlbWVzLmN1cnJlbnQgPSAtPiAkKCcjdGhlbWUtY3NzJykuYXR0cignaHJlZicpXG4gICAgdGhlbWVzLmRlZmF1bHQgPSB0aGVtZXMuY3VycmVudCgpXG4gICAgdGhlbWVzLmFwcGx5ID0gKHBhdGggPSBudWxsKSAtPlxuICAgICAgdG9BcHBseSA9IHJlc29sdmVQYXRoRnJvbU1hcnAocGF0aCB8fCB0aGVtZXMuZGVmYXVsdClcblxuICAgICAgaWYgdG9BcHBseSBpc250IHRoZW1lcy5jdXJyZW50KClcbiAgICAgICAgJCgnI3RoZW1lLWNzcycpLmF0dHIoJ2hyZWYnLCB0b0FwcGx5KVxuICAgICAgICBzZXRUaW1lb3V0IGFwcGx5U2NyZWVuU2l6ZSwgMjBcblxuICAgICAgICByZXR1cm4gdG9BcHBseS5tYXRjaCgvKFteXFwvXSspXFwuY3NzJC8pWzFdXG4gICAgICBmYWxzZVxuXG4gICAgc2V0U3R5bGUgPSAoaWRlbnRpZmllciwgY3NzKSAtPlxuICAgICAgaWQgID0gXCJtZHMtI3tpZGVudGlmaWVyfVN0eWxlXCJcbiAgICAgIGVsbSA9ICQoXCIjI3tpZH1cIilcbiAgICAgIGVsbSA9ICQoXCI8c3R5bGUgaWQ9XFxcIiN7aWR9XFxcIj48L3N0eWxlPlwiKS5hcHBlbmRUbyhkb2N1bWVudC5oZWFkKSBpZiBlbG0ubGVuZ3RoIDw9IDBcbiAgICAgIGVsbS50ZXh0KGNzcylcblxuICAgIGdldENTU3ZhciA9IChwcm9wKSAtPiBkb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKGRvY3VtZW50LmJvZHkpLmdldFByb3BlcnR5VmFsdWUocHJvcClcblxuICAgIGdldFNsaWRlU2l6ZSA9IC0+XG4gICAgICBzaXplID1cbiAgICAgICAgdzogK2dldENTU3ZhciAnLS1zbGlkZS13aWR0aCdcbiAgICAgICAgaDogK2dldENTU3ZhciAnLS1zbGlkZS1oZWlnaHQnXG5cbiAgICAgIHNpemUucmF0aW8gPSBzaXplLncgLyBzaXplLmhcbiAgICAgIHNpemVcblxuICAgIGFwcGx5U2xpZGVTaXplID0gKHdpZHRoLCBoZWlnaHQpIC0+XG4gICAgICBzZXRTdHlsZSAnc2xpZGVTaXplJyxcbiAgICAgICAgXCJcIlwiXG4gICAgICAgIGJvZHkge1xuICAgICAgICAgIC0tc2xpZGUtd2lkdGg6ICN7d2lkdGggfHwgJ2luaGVyaXQnfTtcbiAgICAgICAgICAtLXNsaWRlLWhlaWdodDogI3toZWlnaHQgfHwgJ2luaGVyaXQnfTtcbiAgICAgICAgfVxuICAgICAgICBcIlwiXCJcbiAgICAgIGFwcGx5U2NyZWVuU2l6ZSgpXG5cbiAgICBnZXRTY3JlZW5TaXplID0gLT5cbiAgICAgIHNpemUgPVxuICAgICAgICB3OiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGhcbiAgICAgICAgaDogZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodFxuXG4gICAgICBwcmV2aWV3TWFyZ2luID0gK2dldENTU3ZhciAnLS1wcmV2aWV3LW1hcmdpbidcbiAgICAgIHNpemUucmF0aW8gPSAoc2l6ZS53IC0gcHJldmlld01hcmdpbiAqIDIpIC8gKHNpemUuaCAtIHByZXZpZXdNYXJnaW4gKiAyKVxuICAgICAgc2l6ZVxuXG4gICAgYXBwbHlTY3JlZW5TaXplID0gLT5cbiAgICAgIHNpemUgPSBnZXRTY3JlZW5TaXplKClcbiAgICAgIHNldFN0eWxlICdzY3JlZW5TaXplJywgXCJib2R5IHsgLS1zY3JlZW4td2lkdGg6ICN7c2l6ZS53fTsgLS1zY3JlZW4taGVpZ2h0OiAje3NpemUuaH07IH1cIlxuICAgICAgJCgnI2NvbnRhaW5lcicpLnRvZ2dsZUNsYXNzICdoZWlnaHQtYmFzZScsIHNpemUucmF0aW8gPiBnZXRTbGlkZVNpemUoKS5yYXRpb1xuXG4gICAgIyDjg5rjg7zjgrjnlarlj7fjgpLlj5fjgZHlj5bjgaPjgZ/jgYLjgajjgIHnj77lnKjjga7jg5rjg7zjgrjku6XlpJbjga7jg5rjg7zjgrjjga7jgrnjg6njgqTjg4njgpLpnZ7ooajnpLrjgavjgZnjgotcbiAgICAjIOOBn+OBoOOBl+OAgemdnuODl+ODquODs+ODiOeKtuaFi+OBruaZgumZkOWumlxuICAgIGFwcGx5Q3VycmVudFBhZ2UgPSAocGFnZSkgLT5cbiAgICAgIHNldFN0eWxlICdjdXJyZW50UGFnZScsXG4gICAgICAgIFwiXCJcIlxuICAgICAgICBAbWVkaWEgbm90IHByaW50IHtcbiAgICAgICAgICBib2R5LnNsaWRlLXZpZXcuc2NyZWVuIC5zbGlkZV93cmFwcGVyOm5vdCg6bnRoLW9mLXR5cGUoI3twYWdlfSkpIHtcbiAgICAgICAgICAgIHdpZHRoOiAwICFpbXBvcnRhbnQ7XG4gICAgICAgICAgICBoZWlnaHQ6IDAgIWltcG9ydGFudDtcbiAgICAgICAgICAgIGJvcmRlcjogbm9uZSAhaW1wb3J0YW50O1xuICAgICAgICAgICAgYm94LXNoYWRvdzogbm9uZSAhaW1wb3J0YW50O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcIlwiXCJcblxuICAgIHJlbmRlciA9IChtZCkgLT5cbiAgICAgIGFwcGx5U2xpZGVTaXplIG1kLnNldHRpbmdzLmdldEdsb2JhbCgnd2lkdGgnKSwgbWQuc2V0dGluZ3MuZ2V0R2xvYmFsKCdoZWlnaHQnKVxuICAgICAgbWQuY2hhbmdlZFRoZW1lID0gdGhlbWVzLmFwcGx5IG1kLnNldHRpbmdzLmdldEdsb2JhbCgndGhlbWUnKVxuICAgICAgJCgnI21hcmtkb3duJykuaHRtbChtZC5wYXJzZWQpXG5cbiAgICAgICMgeW91dHViZSBwbHVnaW4gcmVwbGFjZW1lbnQgZXguIEBbeW91dHViZV0oaHR0cHM6Ly9+KVxuICAgICAgIyBpZiB1cmwgPSAkKCcuZW1iZWQtcmVzcG9uc2l2ZS1pdGVtJykuYXR0cignc3JjJylcbiAgICAgICMgICBjb25zb2xlLmxvZyB1cmxcbiAgICAgICMgICBjb25zb2xlLmxvZyB1cmwuaW5kZXhPZihcImZpbGU6XCIpXG4gICAgICAjICAgdXJsID0gJ2h0dHBzOicgKyB1cmxcbiAgICAgICMgICAkKCcuZW1iZWQtcmVzcG9uc2l2ZS1pdGVtJykuYXR0cignc3JjJywgdXJsKVxuXG4gICAgICBpcGMuc2VuZFRvSG9zdCAncmVuZGVyZWQnLCBtZFxuICAgICAgaXBjLnNlbmRUb0hvc3QgJ3J1bGVyQ2hhbmdlZCcsIG1kLnJ1bGVycyBpZiBtZC5ydWxlckNoYW5nZWRcbiAgICAgIGlwYy5zZW5kVG9Ib3N0ICd0aGVtZUNoYW5nZWQnLCBtZC5jaGFuZ2VkVGhlbWUgaWYgbWQuY2hhbmdlZFRoZW1lXG5cbiAgICBzZW5kUGRmT3B0aW9ucyA9IChvcHRzKSAtPlxuICAgICAgc2xpZGVTaXplID0gZ2V0U2xpZGVTaXplKClcblxuICAgICAgb3B0cy5leHBvcnRTaXplID1cbiAgICAgICAgd2lkdGg6ICBNYXRoLmZsb29yKHNsaWRlU2l6ZS53ICogMjU0MDAgLyA5NilcbiAgICAgICAgaGVpZ2h0OiBNYXRoLmZsb29yKHNsaWRlU2l6ZS5oICogMjU0MDAgLyA5NilcblxuICAgICAgIyBMb2FkIHNsaWRlIHJlc291cmNlc1xuICAgICAgJCgnYm9keScpLmFkZENsYXNzICd0by1wZGYnXG4gICAgICBzZXRUaW1lb3V0ICgtPiBpcGMuc2VuZFRvSG9zdCAncmVzcG9uc2VQZGZPcHRpb25zJywgb3B0cyksIDBcblxuICAgIHNldEltYWdlRGlyZWN0b3J5ID0gKGRpcikgLT4gJCgnaGVhZCA+IGJhc2UnKS5hdHRyKCdocmVmJywgZGlyIHx8ICcuLycpXG5cbiAgICBpcGMub24gJ3JlbmRlcicsIChlLCBtZCkgLT4gcmVuZGVyKE1hcmtkb3duLnBhcnNlKG1kKSlcbiAgICBpcGMub24gJ2N1cnJlbnRQYWdlJywgKGUsIHBhZ2UpIC0+IGFwcGx5Q3VycmVudFBhZ2UgcGFnZVxuICAgIGlwYy5vbiAnc2V0Q2xhc3MnLCAoZSwgY2xhc3NlcykgLT4gJCgnYm9keScpLmF0dHIgJ2NsYXNzJywgY2xhc3Nlc1xuICAgIGlwYy5vbiAnc2V0SW1hZ2VEaXJlY3RvcnknLCAoZSwgZGlyKSAtPiBzZXRJbWFnZURpcmVjdG9yeShkaXIpXG4gICAgaXBjLm9uICdyZXF1ZXN0UGRmT3B0aW9ucycsIChlLCBvcHRzKSAtPiBzZW5kUGRmT3B0aW9ucyhvcHRzIHx8IHt9KVxuICAgIGlwYy5vbiAndW5mcmVlemUnLCAtPiAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ3RvLXBkZicpXG5cbiAgICAjIEluaXRpYWxpemVcbiAgICAkKGRvY3VtZW50KS5vbiAnY2xpY2snLCAnYScsIChlKSAtPlxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICBpcGMuc2VuZFRvSG9zdCAnbGlua1RvJywgJChlLmN1cnJlbnRUYXJnZXQpLmF0dHIoJ2hyZWYnKVxuXG4gICAgJCh3aW5kb3cpLnJlc2l6ZSAoZSkgLT4gYXBwbHlTY3JlZW5TaXplKClcbiAgICBhcHBseVNjcmVlblNpemUoKVxuXG5cbiAgICAjIHByZXNlbnRhdGlvbiA9PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAgICMgbWFya2Rvd25Cb2R544KSSFRNTOOBneOBruOBvuOBvumAgeS/oeOBmeOCi1ZlclxuICAgICMgaXBjLm9uICdyZXF1ZXN0U2xpZGVJbmZvJywgKCkgPT5cbiAgICAjICAgY29uc29sZS5sb2cgJ3JlY2VpdmUgcmVxdWVzdFNsaWRlSW5mbydcbiAgICAjICAgbWFya2Rvd25Cb2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1hcmtkb3duLWJvZHknKVxuICAgICMgICMgY29uc29sZS5sb2cgbWFya2Rvd25Cb2R5LmlubmVySFRNTFxuICAgICMgICBpcGMuc2VuZFRvSG9zdCAnc2VuZFNsaWRlSW5mbycsIG1hcmtkb3duQm9keS5pbm5lckhUTUxcbiAgICAjICAgY29uc29sZS5sb2cgbWFya2Rvd25Cb2R5LmlubmVySFRNTFxuICAgICMgICBjb25zb2xlLmxvZyAnc2VuZCBzZW5kU2xpZGVJbmZvJ1xuXG4gICAgIyBtYXJrZG93bkJvZHnjgpLjgqrjg5bjgrjjgqfjgq/jg4jjgafpgIHkv6HjgZnjgotWZXJcbiAgICBpcGMub24gJ3JlcXVlc3RTbGlkZUluZm8nLCAoKSA9PlxuICAgICAgY29uc29sZS5sb2cgJ3JlY2VpdmUgcmVxdWVzdFNsaWRlSW5mbydcbiAgICAgIG1hcmtkb3duQm9keSA9IFtdXG4gICAgICAkKCcuc2xpZGVfd3JhcHBlcicpLmVhY2ggKGlkeCwgZWxlbSkgPT5cbiAgICAgICAgbWFya2Rvd25Cb2R5LnB1c2ggZWxlbS5vdXRlckhUTUwgIyA8ZGl2IGNsYXNzPXNsaWRlX3dyYXBwZXIgaWQ9MT4gLi4uXG5cbiAgICAgIGNvbnNvbGUubG9nIG1hcmtkb3duQm9keVxuXG4gICAgICBpcGMuc2VuZFRvSG9zdCAnc2VuZFNsaWRlSW5mbycsIG1hcmtkb3duQm9keVxuICAgICAgY29uc29sZS5sb2cgJ3NlbmQgc2VuZFNsaWRlSW5mbydcblxuICAgICMgaXBjLm9uICdzZXRTbGlkZScsIChlLCB0ZXh0KSA9PlxuICAgICMgICBjb25zb2xlLmxvZyAncmVjZWl2ZSBzZXRUZXh0J1xuICAgICMgICBjb25zb2xlLmxvZyB0ZXh0XG4gICAgICAjICQoJy5tYXJrZG93bi1ib2R5JykuaHRtbCh0ZXh0KVxuICAgIGlwYy5zZW5kVG9Ib3N0ICdyZXF1ZXN0U2xpZGVIVE1MJywgKCkgPT5cbiAgICAgIGNvbnNvbGUubG9nICdzZW5kIHJlcXVlc3RTbGlkZUhUTUwnXG5cbiAgICBpcGMub24gJ3NldFNsaWRlJywgKGUsIHRleHQpID0+XG4gICAgICBjb25zb2xlLmxvZyAncmVjZWl2ZSBzZXRTbGlkZSdcbiAgICAgIGNvbnNvbGUubG9nIHRleHRcbiAgICAgIGNvbnNvbGUubG9nICQoJy5tYXJrZG93bi1ib2R5JykuaHRtbCh0ZXh0KVxuXG4gICAgaXBjLm9uICdnb1RvUGFnZScsIChlLCBwYWdlKSA9PlxuICAgICAgY29uc29sZS5sb2cgcGFnZVxuICAgICAgYXBwbHlDdXJyZW50UGFnZSBwYWdlXG5cblxuIl19
