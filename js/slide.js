var Path, clsMarkdown, ipc, resolvePathFromMarp;

clsMarkdown = require('./classes/mds_markdown');

ipc = require('electron').ipcRenderer;

Path = require('path');

resolvePathFromMarp = function(path) {
  if (path == null) {
    path = './';
  }
  return Path.resolve(__dirname, '../', path);
};

document.addEventListener('DOMContentLoaded', function() {
  var $;
  $ = window.jQuery = window.$ = require('jquery');
  return (function($) {
    var Markdown, applyCurrentPage, applyScreenSize, applySlideSize, getCSSvar, getScreenSize, getSlideSize, render, sendPdfOptions, setImageDirectory, setStyle, themes;
    $("[data-marp-path-resolver]").each(function() {
      var i, len, ref, results, target;
      ref = $(this).attr('data-marp-path-resolver').split(/\s+/);
      results = [];
      for (i = 0, len = ref.length; i < len; i++) {
        target = ref[i];
        results.push($(this).attr(target, resolvePathFromMarp($(this).attr(target))));
      }
      return results;
    });
    Markdown = new clsMarkdown({
      afterRender: clsMarkdown.generateAfterRender($)
    });
    themes = {};
    themes.current = function() {
      return $('#theme-css').attr('href');
    };
    themes["default"] = themes.current();
    themes.apply = function(path) {
      var toApply;
      if (path == null) {
        path = null;
      }
      toApply = resolvePathFromMarp(path || themes["default"]);
      if (toApply !== themes.current()) {
        $('#theme-css').attr('href', toApply);
        setTimeout(applyScreenSize, 20);
        return toApply.match(/([^\/]+)\.css$/)[1];
      }
      return false;
    };
    setStyle = function(identifier, css) {
      var elm, id;
      id = "mds-" + identifier + "Style";
      elm = $("#" + id);
      if (elm.length <= 0) {
        elm = $("<style id=\"" + id + "\"></style>").appendTo(document.head);
      }
      return elm.text(css);
    };
    getCSSvar = function(prop) {
      return document.defaultView.getComputedStyle(document.body).getPropertyValue(prop);
    };
    getSlideSize = function() {
      var size;
      size = {
        w: +getCSSvar('--slide-width'),
        h: +getCSSvar('--slide-height')
      };
      size.ratio = size.w / size.h;
      return size;
    };
    applySlideSize = function(width, height) {
      setStyle('slideSize', "body {\n  --slide-width: " + (width || 'inherit') + ";\n  --slide-height: " + (height || 'inherit') + ";\n}");
      return applyScreenSize();
    };
    getScreenSize = function() {
      var previewMargin, size;
      size = {
        w: document.documentElement.clientWidth,
        h: document.documentElement.clientHeight
      };
      previewMargin = +getCSSvar('--preview-margin');
      size.ratio = (size.w - previewMargin * 2) / (size.h - previewMargin * 2);
      return size;
    };
    applyScreenSize = function() {
      var size;
      size = getScreenSize();
      setStyle('screenSize', "body { --screen-width: " + size.w + "; --screen-height: " + size.h + "; }");
      return $('#container').toggleClass('height-base', size.ratio > getSlideSize().ratio);
    };
    applyCurrentPage = function(page) {
      return setStyle('currentPage', "@media not print {\n  body.slide-view.screen .slide_wrapper:not(:nth-of-type(" + page + ")) {\n    width: 0 !important;\n    height: 0 !important;\n    border: none !important;\n    box-shadow: none !important;\n  }\n}");
    };
    render = function(md) {
      applySlideSize(md.settings.getGlobal('width'), md.settings.getGlobal('height'));
      md.changedTheme = themes.apply(md.settings.getGlobal('theme'));
      $('#markdown').html(md.parsed);
      ipc.sendToHost('rendered', md);
      if (md.rulerChanged) {
        ipc.sendToHost('rulerChanged', md.rulers);
      }
      if (md.changedTheme) {
        return ipc.sendToHost('themeChanged', md.changedTheme);
      }
    };
    sendPdfOptions = function(opts) {
      var slideSize;
      slideSize = getSlideSize();
      opts.exportSize = {
        width: Math.floor(slideSize.w * 25400 / 96),
        height: Math.floor(slideSize.h * 25400 / 96)
      };
      $('body').addClass('to-pdf');
      return setTimeout((function() {
        return ipc.sendToHost('responsePdfOptions', opts);
      }), 0);
    };
    setImageDirectory = function(dir) {
      return $('head > base').attr('href', dir || './');
    };
    ipc.on('render', function(e, md) {
      return render(Markdown.parse(md));
    });
    ipc.on('currentPage', function(e, page) {
      return applyCurrentPage(page);
    });
    ipc.on('setClass', function(e, classes) {
      return $('body').attr('class', classes);
    });
    ipc.on('setImageDirectory', function(e, dir) {
      return setImageDirectory(dir);
    });
    ipc.on('requestPdfOptions', function(e, opts) {
      return sendPdfOptions(opts || {});
    });
    ipc.on('unfreeze', function() {
      return $('body').removeClass('to-pdf');
    });
    $(document).on('click', 'a', function(e) {
      e.preventDefault();
      return ipc.sendToHost('linkTo', $(e.currentTarget).attr('href'));
    });
    $(window).resize(function(e) {
      return applyScreenSize();
    });
    applyScreenSize();
    ipc.on('requestSlideInfo', (function(_this) {
      return function() {
        var markdownBody;
        console.log('receive requestSlideInfo');
        markdownBody = [];
        $('.slide_wrapper').each(function(idx, elem) {
          return markdownBody.push(elem.outerHTML);
        });
        console.log(markdownBody);
        ipc.sendToHost('sendSlideInfo', markdownBody);
        return console.log('send sendSlideInfo');
      };
    })(this));
    ipc.sendToHost('requestSlideHTML', (function(_this) {
      return function() {
        return console.log('send requestSlideHTML');
      };
    })(this));
    ipc.on('setSlide', (function(_this) {
      return function(e, text) {
        console.log('receive setSlide');
        console.log(text);
        return console.log($('.markdown-body').html(text));
      };
    })(this));
    return ipc.on('goToPage', (function(_this) {
      return function(e, page) {
        console.log(page);
        return applyCurrentPage(page);
      };
    })(this));
  })($);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2xpZGUuanMiLCJzb3VyY2VzIjpbInNsaWRlLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBOztBQUFBLFdBQUEsR0FBYyxPQUFBLENBQVEsd0JBQVI7O0FBQ2QsR0FBQSxHQUFjLE9BQUEsQ0FBUSxVQUFSLENBQW1CLENBQUM7O0FBQ2xDLElBQUEsR0FBYyxPQUFBLENBQVEsTUFBUjs7QUFFZCxtQkFBQSxHQUFzQixTQUFDLElBQUQ7O0lBQUMsT0FBTzs7U0FBUyxJQUFJLENBQUMsT0FBTCxDQUFhLFNBQWIsRUFBd0IsS0FBeEIsRUFBK0IsSUFBL0I7QUFBakI7O0FBRXRCLFFBQVEsQ0FBQyxnQkFBVCxDQUEwQixrQkFBMUIsRUFBOEMsU0FBQTtBQUM1QyxNQUFBO0VBQUEsQ0FBQSxHQUFJLE1BQU0sQ0FBQyxNQUFQLEdBQWdCLE1BQU0sQ0FBQyxDQUFQLEdBQVcsT0FBQSxDQUFRLFFBQVI7U0FFNUIsQ0FBQSxTQUFDLENBQUQ7QUFFRCxRQUFBO0lBQUEsQ0FBQSxDQUFFLDJCQUFGLENBQThCLENBQUMsSUFBL0IsQ0FBb0MsU0FBQTtBQUNsQyxVQUFBO0FBQUE7QUFBQTtXQUFBLHFDQUFBOztxQkFDRSxDQUFBLENBQUUsSUFBRixDQUFJLENBQUMsSUFBTCxDQUFVLE1BQVYsRUFBa0IsbUJBQUEsQ0FBb0IsQ0FBQSxDQUFFLElBQUYsQ0FBSSxDQUFDLElBQUwsQ0FBVSxNQUFWLENBQXBCLENBQWxCO0FBREY7O0lBRGtDLENBQXBDO0lBSUEsUUFBQSxHQUFXLElBQUksV0FBSixDQUFnQjtNQUFFLFdBQUEsRUFBYSxXQUFXLENBQUMsbUJBQVosQ0FBZ0MsQ0FBaEMsQ0FBZjtLQUFoQjtJQUVYLE1BQUEsR0FBUztJQUNULE1BQU0sQ0FBQyxPQUFQLEdBQWlCLFNBQUE7YUFBRyxDQUFBLENBQUUsWUFBRixDQUFlLENBQUMsSUFBaEIsQ0FBcUIsTUFBckI7SUFBSDtJQUNqQixNQUFNLEVBQUMsT0FBRCxFQUFOLEdBQWlCLE1BQU0sQ0FBQyxP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QUo7UUFDakIsT0FBTyxDQUFDLEdBQVIsQ0FBWSxJQUFaO2VBQ0EsZ0JBQUEsQ0FBaUIsSUFBakI7TUFGaUI7SUFBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLENBQW5CO0VBNUpDLENBQUEsQ0FBSCxDQUFJLENBQUo7QUFINEMsQ0FBOUMiLCJzb3VyY2VzQ29udGVudCI6WyJjbHNNYXJrZG93biA9IHJlcXVpcmUgJy4vY2xhc3Nlcy9tZHNfbWFya2Rvd24nXG5pcGMgICAgICAgICA9IHJlcXVpcmUoJ2VsZWN0cm9uJykuaXBjUmVuZGVyZXJcblBhdGggICAgICAgID0gcmVxdWlyZSAncGF0aCdcblxucmVzb2x2ZVBhdGhGcm9tTWFycCA9IChwYXRoID0gJy4vJykgLT4gUGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uLycsIHBhdGgpXG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgJ0RPTUNvbnRlbnRMb2FkZWQnLCAtPlxuICAkID0gd2luZG93LmpRdWVyeSA9IHdpbmRvdy4kID0gcmVxdWlyZSgnanF1ZXJ5JylcblxuICBkbyAoJCkgLT5cbiAgICAjIEZpcnN0LCByZXNvbHZlIE1hcnAgcmVzb3VyY2VzIHBhdGhcbiAgICAkKFwiW2RhdGEtbWFycC1wYXRoLXJlc29sdmVyXVwiKS5lYWNoIC0+XG4gICAgICBmb3IgdGFyZ2V0IGluICQoQCkuYXR0cignZGF0YS1tYXJwLXBhdGgtcmVzb2x2ZXInKS5zcGxpdCgvXFxzKy8pXG4gICAgICAgICQoQCkuYXR0cih0YXJnZXQsIHJlc29sdmVQYXRoRnJvbU1hcnAoJChAKS5hdHRyKHRhcmdldCkpKVxuXG4gICAgTWFya2Rvd24gPSBuZXcgY2xzTWFya2Rvd24oeyBhZnRlclJlbmRlcjogY2xzTWFya2Rvd24uZ2VuZXJhdGVBZnRlclJlbmRlcigkKSB9KVxuXG4gICAgdGhlbWVzID0ge31cbiAgICB0aGVtZXMuY3VycmVudCA9IC0+ICQoJyN0aGVtZS1jc3MnKS5hdHRyKCdocmVmJylcbiAgICB0aGVtZXMuZGVmYXVsdCA9IHRoZW1lcy5jdXJyZW50KClcbiAgICB0aGVtZXMuYXBwbHkgPSAocGF0aCA9IG51bGwpIC0+XG4gICAgICB0b0FwcGx5ID0gcmVzb2x2ZVBhdGhGcm9tTWFycChwYXRoIHx8IHRoZW1lcy5kZWZhdWx0KVxuXG4gICAgICBpZiB0b0FwcGx5IGlzbnQgdGhlbWVzLmN1cnJlbnQoKVxuICAgICAgICAkKCcjdGhlbWUtY3NzJykuYXR0cignaHJlZicsIHRvQXBwbHkpXG4gICAgICAgIHNldFRpbWVvdXQgYXBwbHlTY3JlZW5TaXplLCAyMFxuXG4gICAgICAgIHJldHVybiB0b0FwcGx5Lm1hdGNoKC8oW15cXC9dKylcXC5jc3MkLylbMV1cbiAgICAgIGZhbHNlXG5cbiAgICBzZXRTdHlsZSA9IChpZGVudGlmaWVyLCBjc3MpIC0+XG4gICAgICBpZCAgPSBcIm1kcy0je2lkZW50aWZpZXJ9U3R5bGVcIlxuICAgICAgZWxtID0gJChcIiMje2lkfVwiKVxuICAgICAgZWxtID0gJChcIjxzdHlsZSBpZD1cXFwiI3tpZH1cXFwiPjwvc3R5bGU+XCIpLmFwcGVuZFRvKGRvY3VtZW50LmhlYWQpIGlmIGVsbS5sZW5ndGggPD0gMFxuICAgICAgZWxtLnRleHQoY3NzKVxuXG4gICAgZ2V0Q1NTdmFyID0gKHByb3ApIC0+IGRvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUoZG9jdW1lbnQuYm9keSkuZ2V0UHJvcGVydHlWYWx1ZShwcm9wKVxuXG4gICAgZ2V0U2xpZGVTaXplID0gLT5cbiAgICAgIHNpemUgPVxuICAgICAgICB3OiArZ2V0Q1NTdmFyICctLXNsaWRlLXdpZHRoJ1xuICAgICAgICBoOiArZ2V0Q1NTdmFyICctLXNsaWRlLWhlaWdodCdcblxuICAgICAgc2l6ZS5yYXRpbyA9IHNpemUudyAvIHNpemUuaFxuICAgICAgc2l6ZVxuXG4gICAgYXBwbHlTbGlkZVNpemUgPSAod2lkdGgsIGhlaWdodCkgLT5cbiAgICAgIHNldFN0eWxlICdzbGlkZVNpemUnLFxuICAgICAgICBcIlwiXCJcbiAgICAgICAgYm9keSB7XG4gICAgICAgICAgLS1zbGlkZS13aWR0aDogI3t3aWR0aCB8fCAnaW5oZXJpdCd9O1xuICAgICAgICAgIC0tc2xpZGUtaGVpZ2h0OiAje2hlaWdodCB8fCAnaW5oZXJpdCd9O1xuICAgICAgICB9XG4gICAgICAgIFwiXCJcIlxuICAgICAgYXBwbHlTY3JlZW5TaXplKClcblxuICAgIGdldFNjcmVlblNpemUgPSAtPlxuICAgICAgc2l6ZSA9XG4gICAgICAgIHc6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aFxuICAgICAgICBoOiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0XG5cbiAgICAgIHByZXZpZXdNYXJnaW4gPSArZ2V0Q1NTdmFyICctLXByZXZpZXctbWFyZ2luJ1xuICAgICAgc2l6ZS5yYXRpbyA9IChzaXplLncgLSBwcmV2aWV3TWFyZ2luICogMikgLyAoc2l6ZS5oIC0gcHJldmlld01hcmdpbiAqIDIpXG4gICAgICBzaXplXG5cbiAgICBhcHBseVNjcmVlblNpemUgPSAtPlxuICAgICAgc2l6ZSA9IGdldFNjcmVlblNpemUoKVxuICAgICAgc2V0U3R5bGUgJ3NjcmVlblNpemUnLCBcImJvZHkgeyAtLXNjcmVlbi13aWR0aDogI3tzaXplLnd9OyAtLXNjcmVlbi1oZWlnaHQ6ICN7c2l6ZS5ofTsgfVwiXG4gICAgICAkKCcjY29udGFpbmVyJykudG9nZ2xlQ2xhc3MgJ2hlaWdodC1iYXNlJywgc2l6ZS5yYXRpbyA+IGdldFNsaWRlU2l6ZSgpLnJhdGlvXG5cbiAgICAjIOODmuODvOOCuOeVquWPt+OCkuWPl+OBkeWPluOBo+OBn+OBguOBqOOAgeePvuWcqOOBruODmuODvOOCuOS7peWkluOBruODmuODvOOCuOOBruOCueODqeOCpOODieOCkumdnuihqOekuuOBq+OBmeOCi1xuICAgICMg44Gf44Gg44GX44CB6Z2e44OX44Oq44Oz44OI54q25oWL44Gu5pmC6ZmQ5a6aXG4gICAgYXBwbHlDdXJyZW50UGFnZSA9IChwYWdlKSAtPlxuICAgICAgc2V0U3R5bGUgJ2N1cnJlbnRQYWdlJyxcbiAgICAgICAgXCJcIlwiXG4gICAgICAgIEBtZWRpYSBub3QgcHJpbnQge1xuICAgICAgICAgIGJvZHkuc2xpZGUtdmlldy5zY3JlZW4gLnNsaWRlX3dyYXBwZXI6bm90KDpudGgtb2YtdHlwZSgje3BhZ2V9KSkge1xuICAgICAgICAgICAgd2lkdGg6IDAgIWltcG9ydGFudDtcbiAgICAgICAgICAgIGhlaWdodDogMCAhaW1wb3J0YW50O1xuICAgICAgICAgICAgYm9yZGVyOiBub25lICFpbXBvcnRhbnQ7XG4gICAgICAgICAgICBib3gtc2hhZG93OiBub25lICFpbXBvcnRhbnQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFwiXCJcIlxuXG4gICAgcmVuZGVyID0gKG1kKSAtPlxuICAgICAgYXBwbHlTbGlkZVNpemUgbWQuc2V0dGluZ3MuZ2V0R2xvYmFsKCd3aWR0aCcpLCBtZC5zZXR0aW5ncy5nZXRHbG9iYWwoJ2hlaWdodCcpXG4gICAgICBtZC5jaGFuZ2VkVGhlbWUgPSB0aGVtZXMuYXBwbHkgbWQuc2V0dGluZ3MuZ2V0R2xvYmFsKCd0aGVtZScpXG4gICAgICAkKCcjbWFya2Rvd24nKS5odG1sKG1kLnBhcnNlZClcblxuICAgICAgIyB5b3V0dWJlIHBsdWdpbiByZXBsYWNlbWVudCBleC4gQFt5b3V0dWJlXShodHRwczovL34pXG4gICAgICAjIGlmIHVybCA9ICQoJy5lbWJlZC1yZXNwb25zaXZlLWl0ZW0nKS5hdHRyKCdzcmMnKVxuICAgICAgIyAgIGNvbnNvbGUubG9nIHVybFxuICAgICAgIyAgIGNvbnNvbGUubG9nIHVybC5pbmRleE9mKFwiZmlsZTpcIilcbiAgICAgICMgICB1cmwgPSAnaHR0cHM6JyArIHVybFxuICAgICAgIyAgICQoJy5lbWJlZC1yZXNwb25zaXZlLWl0ZW0nKS5hdHRyKCdzcmMnLCB1cmwpXG5cbiAgICAgIGlwYy5zZW5kVG9Ib3N0ICdyZW5kZXJlZCcsIG1kXG4gICAgICBpcGMuc2VuZFRvSG9zdCAncnVsZXJDaGFuZ2VkJywgbWQucnVsZXJzIGlmIG1kLnJ1bGVyQ2hhbmdlZFxuICAgICAgaXBjLnNlbmRUb0hvc3QgJ3RoZW1lQ2hhbmdlZCcsIG1kLmNoYW5nZWRUaGVtZSBpZiBtZC5jaGFuZ2VkVGhlbWVcblxuICAgIHNlbmRQZGZPcHRpb25zID0gKG9wdHMpIC0+XG4gICAgICBzbGlkZVNpemUgPSBnZXRTbGlkZVNpemUoKVxuXG4gICAgICBvcHRzLmV4cG9ydFNpemUgPVxuICAgICAgICB3aWR0aDogIE1hdGguZmxvb3Ioc2xpZGVTaXplLncgKiAyNTQwMCAvIDk2KVxuICAgICAgICBoZWlnaHQ6IE1hdGguZmxvb3Ioc2xpZGVTaXplLmggKiAyNTQwMCAvIDk2KVxuXG4gICAgICAjIExvYWQgc2xpZGUgcmVzb3VyY2VzXG4gICAgICAkKCdib2R5JykuYWRkQ2xhc3MgJ3RvLXBkZidcbiAgICAgIHNldFRpbWVvdXQgKC0+IGlwYy5zZW5kVG9Ib3N0ICdyZXNwb25zZVBkZk9wdGlvbnMnLCBvcHRzKSwgMFxuXG4gICAgc2V0SW1hZ2VEaXJlY3RvcnkgPSAoZGlyKSAtPiAkKCdoZWFkID4gYmFzZScpLmF0dHIoJ2hyZWYnLCBkaXIgfHwgJy4vJylcblxuICAgIGlwYy5vbiAncmVuZGVyJywgKGUsIG1kKSAtPiByZW5kZXIoTWFya2Rvd24ucGFyc2UobWQpKVxuICAgIGlwYy5vbiAnY3VycmVudFBhZ2UnLCAoZSwgcGFnZSkgLT4gYXBwbHlDdXJyZW50UGFnZSBwYWdlXG4gICAgaXBjLm9uICdzZXRDbGFzcycsIChlLCBjbGFzc2VzKSAtPiAkKCdib2R5JykuYXR0ciAnY2xhc3MnLCBjbGFzc2VzXG4gICAgaXBjLm9uICdzZXRJbWFnZURpcmVjdG9yeScsIChlLCBkaXIpIC0+IHNldEltYWdlRGlyZWN0b3J5KGRpcilcbiAgICBpcGMub24gJ3JlcXVlc3RQZGZPcHRpb25zJywgKGUsIG9wdHMpIC0+IHNlbmRQZGZPcHRpb25zKG9wdHMgfHwge30pXG4gICAgaXBjLm9uICd1bmZyZWV6ZScsIC0+ICQoJ2JvZHknKS5yZW1vdmVDbGFzcygndG8tcGRmJylcblxuICAgICMgSW5pdGlhbGl6ZVxuICAgICQoZG9jdW1lbnQpLm9uICdjbGljaycsICdhJywgKGUpIC0+XG4gICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgIGlwYy5zZW5kVG9Ib3N0ICdsaW5rVG8nLCAkKGUuY3VycmVudFRhcmdldCkuYXR0cignaHJlZicpXG5cbiAgICAkKHdpbmRvdykucmVzaXplIChlKSAtPiBhcHBseVNjcmVlblNpemUoKVxuICAgIGFwcGx5U2NyZWVuU2l6ZSgpXG5cblxuICAgICMgcHJlc2VudGF0aW9uID09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gICAgIyBtYXJrZG93bkJvZHnjgpJIVE1M44Gd44Gu44G+44G+6YCB5L+h44GZ44KLVmVyXG4gICAgIyBpcGMub24gJ3JlcXVlc3RTbGlkZUluZm8nLCAoKSA9PlxuICAgICMgICBjb25zb2xlLmxvZyAncmVjZWl2ZSByZXF1ZXN0U2xpZGVJbmZvJ1xuICAgICMgICBtYXJrZG93bkJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWFya2Rvd24tYm9keScpXG4gICAgIyAgIyBjb25zb2xlLmxvZyBtYXJrZG93bkJvZHkuaW5uZXJIVE1MXG4gICAgIyAgIGlwYy5zZW5kVG9Ib3N0ICdzZW5kU2xpZGVJbmZvJywgbWFya2Rvd25Cb2R5LmlubmVySFRNTFxuICAgICMgICBjb25zb2xlLmxvZyBtYXJrZG93bkJvZHkuaW5uZXJIVE1MXG4gICAgIyAgIGNvbnNvbGUubG9nICdzZW5kIHNlbmRTbGlkZUluZm8nXG5cbiAgICAjIG1hcmtkb3duQm9keeOCkuOCquODluOCuOOCp+OCr+ODiOOBp+mAgeS/oeOBmeOCi1ZlclxuICAgIGlwYy5vbiAncmVxdWVzdFNsaWRlSW5mbycsICgpID0+XG4gICAgICBjb25zb2xlLmxvZyAncmVjZWl2ZSByZXF1ZXN0U2xpZGVJbmZvJ1xuICAgICAgbWFya2Rvd25Cb2R5ID0gW11cbiAgICAgICQoJy5zbGlkZV93cmFwcGVyJykuZWFjaCAoaWR4LCBlbGVtKSA9PlxuICAgICAgICBtYXJrZG93bkJvZHkucHVzaCBlbGVtLm91dGVySFRNTCAjIDxkaXYgY2xhc3M9c2xpZGVfd3JhcHBlciBpZD0xPiAuLi5cblxuICAgICAgY29uc29sZS5sb2cgbWFya2Rvd25Cb2R5XG5cbiAgICAgIGlwYy5zZW5kVG9Ib3N0ICdzZW5kU2xpZGVJbmZvJywgbWFya2Rvd25Cb2R5XG4gICAgICBjb25zb2xlLmxvZyAnc2VuZCBzZW5kU2xpZGVJbmZvJ1xuXG4gICAgIyBpcGMub24gJ3NldFNsaWRlJywgKGUsIHRleHQpID0+XG4gICAgIyAgIGNvbnNvbGUubG9nICdyZWNlaXZlIHNldFRleHQnXG4gICAgIyAgIGNvbnNvbGUubG9nIHRleHRcbiAgICAgICMgJCgnLm1hcmtkb3duLWJvZHknKS5odG1sKHRleHQpXG4gICAgaXBjLnNlbmRUb0hvc3QgJ3JlcXVlc3RTbGlkZUhUTUwnLCAoKSA9PlxuICAgICAgY29uc29sZS5sb2cgJ3NlbmQgcmVxdWVzdFNsaWRlSFRNTCdcblxuICAgIGlwYy5vbiAnc2V0U2xpZGUnLCAoZSwgdGV4dCkgPT5cbiAgICAgIGNvbnNvbGUubG9nICdyZWNlaXZlIHNldFNsaWRlJ1xuICAgICAgY29uc29sZS5sb2cgdGV4dFxuICAgICAgY29uc29sZS5sb2cgJCgnLm1hcmtkb3duLWJvZHknKS5odG1sKHRleHQpXG5cbiAgICBpcGMub24gJ2dvVG9QYWdlJywgKGUsIHBhZ2UpID0+XG4gICAgICBjb25zb2xlLmxvZyBwYWdlXG4gICAgICBhcHBseUN1cnJlbnRQYWdlIHBhZ2VcblxuXG4iXX0=
